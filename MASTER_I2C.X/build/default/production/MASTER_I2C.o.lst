MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00002 ;*              MODIFICAÇÕES PARA USO COM 16F628A                  *
                      00003 ;*                FEITAS POR LUCAS QUEIROZ                         *
                      00004 ;*                    FEVEREIRO DE 2016                            *
                      00005 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00006 
                      00007 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00008 ;*                       NOME DO PROJETO                           *
                      00009 ;*                           CLIENTE                               *
                      00010 ;*         DESENVOLVIDO PELA MOSAICO ENGENHARIA E CONSULTORIA      *
                      00011 ;*   VERSÃO: 1.0                           DATA: 17/06/03          *
                      00012 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00013 ;*                     DESCRIÇÃO DO ARQUIVO                        *
                      00014 ;*-----------------------------------------------------------------*
                      00015 ;*   MODELO PARA O PIC 16F628A                                    *
                      00016 ;*                                                                 *
                      00017 ;*                                                                 *
                      00018 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00019 
                      00020 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00021 ;*                     ARQUIVOS DE DEFINIÇÕES                      *
                      00022 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00023 #INCLUDE <p16f877a.inc>             ;ARQUIVO PADRÃO MICROCHIP PARA 16F877A
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Nov 22 2017
                      00005 ;  MPASM PIC16F877A processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00567         LIST
2007   3F72           00024     __CONFIG _CP_OFF & _CPD_OFF & _DEBUG_OFF & _LVP_OFF & _WRT_OFF & _PWRTE_ON & _WDT_OFF & _HS_OSC & _B
                            ODEN_ON
                      00025     
                      00026 ; CP - CODE PROTECTION (HABILITA OU DESABILITA LEITURA DA MEMÓRIA DE PROGRAMA).
                      00027 ; DEBUG - DEPURADOR DA PLACA ICD 2 (HABILITA OU DESABILITA DEPURADOR DA PLACA ICD 2).
                      00028 ; PWRTE - POWER UP TIMER (HABILITA OU DESABILITA TEMPORIZADOR QUE AGUARDA 72 ms PARA ESTABILIZAR O PIC).
                      00029 ; WDT - WATCHDOG TIMER ("CÃO DE GUARDA" TEMPORIZADOR QUE RESETA O PIC QUANDO SISTEMA TRAVADO).
                      00030 ; BOREN - BROWN OUT DETECT (SE A ALIMENTAÇÃO VDD FOR MENOR QUE 4V DURANTE 100 MICRO-SEG O PIC RESETA).
                      00031 ; LVP - LOW VOLTAGE PROGRAM (SISTEMA DE PROGRAMAÇÃO EM BAIXA TENSÃO).
                      00032 ; XT - OSCILADOR DO TIPO CRISTAL.
                      00033 
                      00034 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00035 ;*                    PAGINAÇÃO DE MEMÓRIA                         *
                      00036 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00037 ;DEFINIÇÃO DE COMANDOS DE USUÁRIO PARA ALTERAÇÃO DA PÁGINA DE MEMÓRIA
                      00038 #DEFINE BANK0   BCF STATUS,RP0  ;SETA BANK 0 DE MEMÓRIA
                      00039 #DEFINE BANK1   BSF STATUS,RP0  ;SETA BANK 1 DE MAMÓRIA
                      00040 
                      00041 
                      00042 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00043 ;*                         VARIÁVEIS                               *
                      00044 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00045 ; DEFINIÇÃO DOS NOMES E ENDEREÇOS DE TODAS AS VARIÁVEIS UTILIZADAS 
                      00046 ; PELO SISTEMA
                      00047 
                      00048         CBLOCK  0x20    ;ENDEREÇO INICIAL DA MEMÓRIA DE
                      00049                                         ;USUÁRIO
  00000020            00050                 W_TEMP          ;REGISTRADORES TEMPORÁRIOS PARA USO
  00000021            00051                 STATUS_TEMP     ;JUNTO ÀS INTERRUPÇÕES
  00000022            00052                 COUNT_SYNC
  00000023            00053                 TEMP
  00000024            00054                 PCLATH_TEMP
  00000025            00055                 FSR_TEMP
                      00056                 
  00000026            00057                 W_AUX
  00000027            00058                 MONITORA_SUBSISTEMAS
  00000028            00059                 DELAY_
  00000029            00060                 BYTE
                      00061                 
                      00062                 ;DADOS
  0000002A            00063                 BITS
  0000002B            00064                 CONT_START_SYNC_MASTER
  0000002C            00065                 DELAY_SYNC
  0000002D            00066                 BARRAMENTO_I2C
                      00067                 
  0000002E            00068                 DADO_SINALIZACAO
  0000002F            00069                 DADO_SENSORES
                      00070                 
  00000030            00071                 MONITORA_BITS
  00000031            00072                 ESTADO_SINALIZACAO
  00000032            00073                 ENDERECO_SINALIZACAO
  00000033            00074                 ENDERECO_SENSORES
  00000034            00075                 VALORES_SENSORES
  00000035            00076                 CONT_2
  00000036            00077                 CONT_1
  00000037            00078                 BARRAMENTO ; REGISTRADOR DE DADOS SOBRE O BARRAMENTO
  00000038            00079                 DADO_I2C
  00000039            00080                 CONT_BYTES_I2C      ; CONTADOR QUE IRÁ AVISAR QUANDO CHEGAR OS 13 BYTES DO I2C
                      00081                                     ; O ULTIMO BIT DIZ QUE TEM DADO NOVO OU NÃO 1- SIM | 0- NÃO
  0000003A            00082                 d1
  0000003B            00083                 d2
  0000003C            00084                 CONTADOR_START_SYNC
  0000003D            00085                 PROPRIETARIO
  0000003E            00086                 CONTADOR_START_BIT
  0000003F            00087                 CONTADOR_BYTES
  00000040            00088                 CONTADOR_BITS
  00000041            00089                 ESTAGIO
  00000042            00090                 ENDERECO_ENVIAR
  00000043            00091                 OPERACIONAL
  00000044            00092                 TEMPO0
                      00093                 ;NOVAS VARIÁVEIS
                      00094 
                      00095         ENDC                    ;FIM DO BLOCO DE MEMÓRIA
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00096                 
                      00097         CBLOCK  0x50
  00000050            00098                 BYTE_0
  00000051            00099                 ENDERECO
  00000052            00100                 DADO
                      00101         ENDC
                      00102         CBLOCK  0x55            ; ESTADO LIDO DOS SUBSISTEMAS DO CARRO
  00000055            00103                 TRACAO
  00000056            00104                 DIRECAO
  00000057            00105                 SINALIZACAO
  00000058            00106                 SENSORES
  00000059            00107                 COLISAO
                      00108         ENDC
                      00109         CBLOCK  0x60
  00000060            00110                 BYTE_0_1
  00000061            00111                 ENDERECO_1
  00000062            00112                 DADO_1
                      00113         ENDC
                      00114         CBLOCK  0X64
                      00115                 ; DADOS RECEBIDOS DO L3
  00000064            00116                 DADO_NULL
  00000065            00117                 TRACAO_L3
  00000066            00118                 DIRECAO_L3
  00000067            00119                 SINALIZACAO_L3
  00000068            00120                 SENSORES_L3
  00000069            00121                 COLISAO_L3
                      00122                 
                      00123         ENDC
                      00124         CBLOCK  0x70                ; CAMPOS DESTINADOS AO PACOTE L3 - 12 BYTES
  00000070            00125                 SOH                 ; INICIO DO PACOTE
  00000071            00126                 IDS                 ; IDENTIFICADOR DE ORIGEM
  00000072            00127                 IDD                 ; IDENTIFICADOR DE DESTINO
  00000073            00128                 COD                 ; CÓDIGO DE INSTRUÇÃO
  00000074            00129                 DATA_P1             ; INFORMAÇAO
  00000075            00130                 DATA_P2             ; INFORMAÇAO
  00000076            00131                 DATA_P3             ; INFORMAÇAO
  00000077            00132                 DATA_P4             ; INFORMAÇAO
  00000078            00133                 DATA_P5             ; INFORMAÇAO
  00000079            00134                 DATA_P6             ; INFORMAÇAO
  0000007A            00135                 PAD                 ; ENCHIMENTO OU IDENTIFICADOR DE FRAGMENTAÇÃO [ NÃO USAREI ] 
  0000007B            00136                 CRC8                ; CÓDIGO DE CHECAGEM DE REDUNDÂNCIA CÍCLICA
                      00137         ENDC
                      00138         
                      00139 ;       CBLOCK  0x50
                      00140 ;               MBYTE_0
                      00141 ;               ANDRESS_MASTER
                      00142 ;               ANDRESS_SUBSISTEMA
                      00143 ;               DADO_MASTER
                      00144 ;       ;NOVAS VARIÁVEIS
                      00145 ;
                      00146 ;       ENDC
                      00147 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00148 ;*                        FLAGS INTERNOS                           *
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00149 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00150 ; DEFINIÇÃO DE TODOS OS FLAGS UTILIZADOS PELO SISTEMA
                      00151 #DEFINE FLAG_COL_START_BIT  BARRAMENTO, 3   ; BIT REFERENTE A COLISAO NO START_BIT
                      00152 #DEFINE FLAG_COL_ENVIAR_BIT BARRAMENTO, 4   ; BIT REFERENTE A COLISAO AO ENVIAR BIT
                      00153 #DEFINE FLAG_COLISAO        BARRAMENTO, 1   ; BIT REFERENTE A COLISAO
                      00154 #DEFINE FLAG_BYTE_0         ESTAGIO, 1      ; FLAG REFERENTE AO ESTAGIO DO BYTE_0
                      00155 #DEFINE FLAG_ENDERECO       ESTAGIO, 2      ; FLAG REFERENTE AO ESTAGIO DO ENDERECO
                      00156 #DEFINE FLAG_DADO           ESTAGIO, 3      ; FLAG REFERENTE AO ESTAGIO DO DADO
                      00157 
                      00158 #DEFINE FAROL               ESTADO_SINALIZACAO, 0
                      00159 #DEFINE RE                  ESTADO_SINALIZACAO, 1
                      00160 #DEFINE FREIO               ESTADO_SINALIZACAO, 2
                      00161 #DEFINE SETA_ESQUERDA       ESTADO_SINALIZACAO, 3
                      00162 #DEFINE SETA_DIREITA        ESTADO_SINALIZACAO, 4
                      00163 #DEFINE REQUISICAO          DADO_SINALIZACAO, 5
                      00164         
                      00165 #DEFINE OP_COLISAO          OPERACIONAL, 2          
                      00166 #DEFINE OP_SENSORES         OPERACIONAL, 3      
                      00167 #DEFINE OP_DIRECAO          OPERACIONAL, 4      
                      00168 #DEFINE OP_TRACAO           OPERACIONAL, 5      
                      00169 #DEFINE OP_SINALIZACAO      OPERACIONAL, 6      
                      00170         
                      00171 #DEFINE SENSOR_1            PORTB, RB4
                      00172 #DEFINE SENSOR_2            PORTB, RB5
                      00173 #DEFINE SENSOR_3            PORTB, RB6
                      00174 #DEFINE SENSOR_4            PORTB, RB7
                      00175 #DEFINE PWM_FREIO           .2              ;   PWM DO FREIO DESACIONADO
                      00176 #DEFINE I2C_ERRO            BARRAMENTO_I2C, 0
                      00177 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00178 ;*                         CONSTANTES                              *
                      00179 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00180 ; DEFINIÇÃO DE TODAS AS CONSTANTES UTILIZADAS PELO SISTEMA
                      00181 
                      00182 ;A PARTIR DO ENDEREÇO ZERO DA EEPROM, DADOS EM ORDEM ALEATÓRIA
2100                  00183         ORG 0x2100
2100   0003 0002 0005 00184         DE      0X03,0X02,0X05,0X40     ; VALORES FIXOS DO SUBSISTEMA
       0040 
                      00185            ;    BYTE END1 END2 DADO
                      00186            ; END1 = DIREÇÃO
                      00187            ; END2 = SINALIZAÇÃO
                      00188 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00189 ;*                           ENTRADAS                              *
                      00190 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00191 ; DEFINIÇÃO DE TODOS OS PINOS QUE SERÃO UTILIZADOS COMO ENTRADA
                      00192 ; RECOMENDAMOS TAMBÉM COMENTAR O SIGNIFICADO DE SEUS ESTADOS (0 E 1)
                      00193 
                      00194 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00195 ;*                           SAÍDAS                                *
                      00196 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00197 ; DEFINIÇÃO DE TODOS OS PINOS QUE SERÃO UTILIZADOS COMO SAÍDA
                      00198 ; RECOMENDAMOS TAMBÉM COMENTAR O SIGNIFICADO DE SEUS ESTADOS (0 E 1)
                      00199 
                      00200 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00201 ;*                       VETOR DE RESET                            *
                      00202 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00203 
0000                  00204         ORG     0x00                    ;ENDEREÇO INICIAL DE PROCESSAMENTO
0000   290D           00205         GOTO    INICIO
                      00206         
                      00207 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00208 ;*                    INÍCIO DA INTERRUPÇÃO                        *
                      00209 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00210 ; ENDEREÇO DE DESVIO DAS INTERRUPÇÕES. A PRIMEIRA TAREFA É SALVAR OS
                      00211 ; VALORES DE "W" E "STATUS" PARA RECUPERAÇÃO FUTURA
                      00212 
                      00213 
                      00214 ;********************************************************************************************* 
                      00215 
                      00216 ;ROTINA DE TRATAMENTO DAS INTERRUPÇOES
0004                  00217         ORG     0X04
                      00218 ;********************************************************************************************* 
                      00219 ; SALVAR E TAL
0004                  00220 SALVA_REGS
0004   1283           00221         BANK0
0005   1485           00222         BSF     PORTA, RA1
                      00223         ;CALL           DELAY10MS
0006   00A0           00224         MOVWF   W_TEMP
0007   0E03           00225         SWAPF   STATUS, W
0008   00A1           00226         MOVWF   STATUS_TEMP
0009   080A           00227         MOVF    PCLATH, W
000A   00A4           00228         MOVWF   PCLATH_TEMP
                      00229         ;MOVF   FSR, W
                      00230         ;MOVWF  FSR_TEMP
                      00231 ;********************************************************************************************* 
                      00232 
                      00233 ;********************************************************************************************* 
                      00234     ; TRATAR O EVENTO
000B   1D8C           00235     BTFSS       PIR1, SSPIF
000C   2859           00236     GOTO        RESGATA_REGS
000D   118C           00237     BCF         PIR1, SSPIF
000E   2014           00238     CALL        TRATA_EVENTO
000F   3A00           00239     XORLW       .0
0010   1D03           00240     BTFSS       STATUS, Z
0011   2859           00241     GOTO        RESGATA_REGS
0012   142D           00242     BSF         I2C_ERRO
0013   2859           00243     GOTO        RESGATA_REGS
                      00244 
                      00245 ;********************************************************************************************* 
                      00246 
0014                  00247 TRATA_EVENTO
0014   1683           00248         BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0015   0814           00249         MOVF    SSPSTAT, W
0016   392D           00250         ANDLW   B'00101101'             ; MASCARA DE BITS
0017   1283           00251         BANK0
0018   00A3           00252         MOVWF   TEMP
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0019   3009           00253         MOVLW   B'00001001'
001A   0623           00254         XORWF   TEMP, W
001B   1D03           00255         BTFSS   STATUS, Z
001C   2823           00256         GOTO    IDENTIF_ESTADO2 
                      00257 
                      00258         ; DISPOSITIVO ESCRAVO RESPONDE A OCORRENCIA DO ESTADO 1
001D                  00259 TRATA_ESTADO1
001D   0813           00260         MOVF            SSPBUF, W               ; REGISTRADOR É LIDO 
001E   3070           00261         MOVLW           0x70                    ; ENDEREÇO DOS DADOS DO L3
001F   0084           00262         MOVWF           FSR
                      00263         
0020   300C           00264         MOVLW           .12
0021   00B9           00265         MOVWF           CONT_BYTES_I2C
0022   3402           00266         RETLW           .2
                      00267 
                      00268 ;********************************************************************************************* 
                      00269 
0023                  00270 IDENTIF_ESTADO2
0023   3029           00271         MOVLW           B'00101001'
0024   0623           00272         XORWF           TEMP, W
0025   1D03           00273         BTFSS           STATUS, Z
0026   282F           00274         GOTO            IDENTIF_ESTADO3
0027                  00275 TRATA_ESTADO2
0027   0813           00276         MOVF            SSPBUF, W
                      00277         ;MOVWF          DADO_I2C
0028   17B7           00278         BSF             BARRAMENTO, 7
0029   0080           00279         MOVWF           INDF
Message[305]: Using default destination of 1 (file).
002A   0A84           00280         INCF            FSR
Message[305]: Using default destination of 1 (file).
002B   0BB9           00281         DECFSZ          CONT_BYTES_I2C      ; TESTA SE JÁ FOI ENVIADO TODOS OS 13 DADOS DO I2C L3
002C   282E           00282             GOTO        $+2                 ; SO PARA PULAR CASO NÃO SEJA ZERO
                      00283             ;BSF                CONT_BYTES_I2C, 7   ; SE ZERAR, SETA QUE TEM DADO NOVO
002D   223B           00284             CALL        TRATA_L3
002E   3402           00285         RETLW           .2
                      00286 
                      00287 ;********************************************************************************************* 
002F                  00288 IDENTIF_ESTADO3 ; ENVIA DADO DO I2C, O PRIMEIRO BYTE
                      00289 
002F   300C           00290         MOVLW           B'00001100'
0030   0623           00291         XORWF           TEMP, W
0031   1D03           00292         BTFSS           STATUS, Z               ; OCORREU ESTADO 3?
0032   2840           00293         GOTO            IDENTIF_ESTADO4
                      00294 
0033                  00295 TRATA_ESTADO3
0033   1683           00296         BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0034   1814           00297         BTFSC           SSPSTAT, BF                     ; TRANSMISSÃO EM ANDAMENTO?
0035   2833           00298         GOTO            TRATA_ESTADO3
0036   1283           00299         BANK0
                      00300 
0037                  00301 ESCREVE_I2C
0037   1394           00302         BCF             SSPCON, WCOL            ; APAGA A FLAG INDICADOR DE ESCRITA
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00303         ;MOVF           DADO_I2C, W     
0038   3070           00304         MOVLW           0X70;0X50
0039   0084           00305         MOVWF           FSR
003A   0800           00306         MOVF            INDF, W
003B   0093           00307         MOVWF           SSPBUF                  ; CARREGA O DADO A SER TRANSMITIDO
003C   1B94           00308         BTFSC           SSPCON, WCOL            ; OCORREU UMA ESCRITA NAO PERMITID
003D   2837           00309         GOTO            ESCREVE_I2C                     ; SIM, TRANSMITE NOVAMENTE
003E   1614           00310         BSF             SSPCON, CKP                     ; NAO, LIBERA A LINHA SCL
003F   3402           00311         RETLW           .2
                      00312 ;********************************************************************************************* 
0040                  00313 IDENTIF_ESTADO4
0040   302C           00314         MOVLW           B'00101100'
0041   0623           00315         XORWF           TEMP, W
0042   1D03           00316         BTFSS           STATUS, Z
0043   2850           00317         GOTO            IDENTIF_ESTADO5
                      00318 
0044                  00319 TRATA_ESTADO4
0044   1683           00320         BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0045   1814           00321         BTFSC           SSPSTAT, BF
0046   2844           00322         GOTO            TRATA_ESTADO4
0047   1283           00323         BANK0
                      00324 
0048                  00325 ESCREVE_I2C_02
0048   1394           00326         BCF             SSPCON, WCOL
Message[305]: Using default destination of 1 (file).
0049   0A84           00327         INCF            FSR
                      00328         ;MOVF           DADO_I2C, W
004A   0800           00329         MOVF            INDF, W
004B   0093           00330         MOVWF           SSPBUF
004C   1B94           00331         BTFSC           SSPCON, WCOL
004D   2848           00332         GOTO            ESCREVE_I2C_02
004E   1614           00333         BSF             SSPCON, CKP
004F   3402           00334         RETLW           .2
                      00335 
                      00336 ;********************************************************************************************* 
                      00337 
                      00338 
0050                  00339 IDENTIF_ESTADO5
                      00340 
0050   3028           00341     MOVLW               B'00101000'
0051   0623           00342     XORWF               TEMP, W
0052   1903           00343     BTFSC               STATUS, Z
0053   2855           00344     GOTO                TRATA_ESTADO5
0054   3400           00345     RETLW               .0
                      00346 
0055                  00347 TRATA_ESTADO5
0055   3001           00348             MOVLW       .1
0056   0184           00349             CLRF        FSR
0057   17B7           00350             BSF         BARRAMENTO, 7   ; HOUVE UMA LEITURA DO I2C
0058   0008           00351             RETURN
                      00352 
                      00353 ;*********************************************************************************************
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00354 
0059                  00355 RESGATA_REGS
                      00356         
0059   188B           00357         BTFSC           INTCON, INTF        ; TESTA SE O FLAG DA INTERRUPÇÃO DO RB0 TA HABILITADA
005A   2862           00358             GOTO    TRATA_BARRAMENTO
005B   0E21           00359         SWAPF           STATUS_TEMP, W
005C   0083           00360         MOVWF           STATUS
005D   0EA0           00361         SWAPF           W_TEMP, F
005E   0E20           00362         SWAPF           W_TEMP, W
005F   0824           00363         MOVF            PCLATH_TEMP, W
0060   008A           00364         MOVWF           PCLATH
                      00365         ;BCF    PORTA, RA1
                      00366         ;MOVF           FSR_TEMP, W
                      00367         ;MOVWF          FSR
0061   0009           00368         RETFIE
                      00369 
                      00370 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00371 ;*                    ROTINA DE INTERRUPÇÃO                        *
                      00372 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00373 ; AQUI SERÁ ESCRITA AS ROTINAS DE RECONHECIMENTO E TRATAMENTO DAS
                      00374 ; INTERRUPÇÕES
                      00375 ; AQUI SERÁ ESCRITA AS ROTINAS DE RECONHECIMENTO E TRATAMENTO DAS
                      00376 ; INTERRUPÇÕES
0062                  00377 TRATA_BARRAMENTO
0062   1214           00378         BCF             SSPCON, CKP                     ; NAO, LIBERA A LINHA SCL
0063   0804           00379         MOVF    FSR, W
0064   00A5           00380         MOVWF   FSR_TEMP
0065   18B7           00381     BTFSC       FLAG_COLISAO
0066   2868           00382         GOTO    TRATAR_COLISAO
0067   286F           00383         GOTO    INICIO_START_SYNC
                      00384 
0068                  00385 TRATAR_COLISAO
0068   1DB7           00386         BTFSS       FLAG_COL_START_BIT
0069   28AA           00387             GOTO    LER_BITS
006A   286B           00388             GOTO    INIC_CONT_START_SYNC
                      00389             
006B                  00390 INIC_CONT_START_SYNC
Message[305]: Using default destination of 1 (file).
006B   0ABC           00391         INCF    CONTADOR_START_SYNC
006C   309B           00392         MOVLW   .155                            ;[ ]    DEIXA ESSE POR ULTIMO TO DO
006D   0081           00393         MOVWF   TMR0
006E   2873           00394         GOTO    START_SYNC
                      00395 ; INTERRUPÇÕES
006F                  00396 INICIO_START_SYNC
006F   3008           00397         MOVLW   .8
0070   00C0           00398         MOVWF   CONTADOR_BITS           ; TEM QUE TER ISSO PARA QUE O CONTADOR DE BITS COMECE COM SE NAO
                             ELE FICA PRESO NO LER BITS
0071   306F           00399         MOVLW   .111;.99;.30;.55                    ; SERÁ VISTO QUANTAS VEZES O TIMER0 ESTOURARÁ [X]
0072   0081           00400         MOVWF   TMR0
0073                  00401 START_SYNC
0073   1806           00402         BTFSC   PORTB, RB0;GP2
0074   287D           00403         GOTO    VERIFICA_SLAVER     ; QUANDO O GP2 DESCER, É TESTADO SE É SLAVE OU MASTER 
0075   190B           00404         BTFSC   INTCON, TMR0IF      ; VERIFICA SE HOUVE ESTOURO DO TIMER 0
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0076   2878           00405         GOTO    INCREMENTA_LIMPA    ; INCREMENTA O CONTADOR DO START_SYNC
0077   2873           00406         GOTO    START_SYNC          ; SE NÃO, REINICIA
                      00407         
0078                  00408 INCREMENTA_LIMPA
0078   193C           00409         BTFSC   CONTADOR_START_SYNC, 2  ; VERIFICA E PASSOU DE 3 O INCREMTETO, SE SIM, SAI
0079   28F6           00410             GOTO        SAI_INT
Message[305]: Using default destination of 1 (file).
007A   0ABC           00411         INCF    CONTADOR_START_SYNC
007B   110B           00412         BCF     INTCON, TMR0IF
007C   286F           00413         GOTO    INICIO_START_SYNC
                      00414         
007D                  00415 VERIFICA_SLAVER
007D   3060           00416         MOVLW   0x60                    ; ENDEREÇO APONTADO CASO SEJA SLAVE NA MEMORIA
007E   0084           00417         MOVWF   FSR                     ; PONTEIRO APONTANDO NO ENDEREÇO 0x30 NA MEMÓRIA RAM
007F   3003           00418         MOVLW   .3                      ; CONTADOR DE BYTES, REFERENTE AO BYTE 0, MELHORAR ESSE DADO
0080   00BF           00419         MOVWF   CONTADOR_BYTES
Message[305]: Using default destination of 1 (file).
0081   0BBC           00420         DECFSZ  CONTADOR_START_SYNC     ; DECREMENTA O CONTADOR E VERIFICA SE ELE É ZERO,
0082   2885           00421         GOTO    VERIFICA_MASTER         ; SE FOR ZERO, O TIMER ZERO ESTOUROU 1 VEZ SÓ, ENTÃO É SLAVE
                      00422         ;BSF    PROPRIETARIO, 0         ; BIT 0 REFERENTE AO SLAVER
0083   103D           00423         BCF     PROPRIETARIO, 0         ; LIMPA QUE NÃO É MASTER
                      00424         ;BSF    GPIO,GP0        
0084   2889           00425         GOTO    START_BIT_INICIO        ; INICIA A VERIFICAÇÃO DO START BIT
                      00426         
0085                  00427 VERIFICA_MASTER                         ; VERIFICA SE É MASTER
Message[305]: Using default destination of 1 (file).
0085   0BBC           00428         DECFSZ  CONTADOR_START_SYNC
0086   28F6           00429         GOTO    SAI_INT                 ; DEU PROBLEMA, NÃO É UM START_SYNC
                      00430         ;BCF    PROPRIETARIO, 0         ; LIMPA QUE NÃO É SLAVE
0087   143D           00431         BSF     PROPRIETARIO, 0         ; BIT 1 REFERENTE AO MASTER
                      00432         ;BSF    PORTA, RA6
                      00433         ;BSF    GPIO,GP0
                      00434         ;MOVLW  0x40
                      00435 
                      00436         ;MOVWF  FSR
                      00437         ;MOVLW  .4
                      00438         ;MOVWF  CONTADOR_BYTES
0088   2889           00439         GOTO    START_BIT_INICIO
                      00440 ;==================================================
0089                  00441 START_BIT_INICIO
                      00442 
                      00443         ;BSF    GPIO, GP1               ; CASO O BARRAMENTO NÃO SUBA, ELE FOI TRATADO ANTERIORMENTE NO S
                            TART_SYNC. SE O BARRAMENTO FICAR EM LOW, TODO O BARRAMENTO ESTARA COM PROBLEMAS
0089   1C06           00444         BTFSS   PORTB, RB0;GP2          ; ESPERA O BARRAMENTO SUBIR
008A   2889           00445         GOTO    START_BIT_INICIO        
008B                  00446 START_BIT_CONFIGURA                     ; CONFIGURA O REINICIO DA CONTAGEM DO START BIT PARA O CONTADOR 
                            QUANDO O TIMER ZERO ESTOURAR
008B   110B           00447         BCF     INTCON, TMR0IF
008C   30AE           00448         MOVLW   .174;.145                       ; O TMR0 ESTOURARÁ A CADA 130 US [X]
008D   0081           00449         MOVWF   TMR0
008E                  00450 START_BIT
008E   1C06           00451         BTFSS   PORTB, RB0;GP2
008F   2897           00452         GOTO    VERIFICA_START_BIT
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0090   190B           00453         BTFSC   INTCON, TMR0IF          ; VERIFICA SE O TIMER ZERO ESTOUROU
0091   2893           00454         GOTO    INCREMENTA_START_BIT    ; SE SIM, INCREMENTA O CONTADOR DO START BIT
0092   288E           00455         GOTO    START_BIT               ; SE NÃO, CONTINUA A CONTAGEM
0093                  00456 INCREMENTA_START_BIT
                      00457          ;BSF   GPIO, GP4
0093   18BE           00458         BTFSC   CONTADOR_START_BIT, 1   ; TESTA SE HOUVE MAIS DE UM ESTOURO DO TIMER0, SE SIM, SAI DA IN
                            TERRUÇÃO
0094   28F6           00459             GOTO        SAI_INT
Message[305]: Using default destination of 1 (file).
0095   0ABE           00460         INCF    CONTADOR_START_BIT      ; INCREMENTA O CONTADOR DO START BIT
0096   288B           00461         GOTO    START_BIT_CONFIGURA 
0097                  00462 VERIFICA_START_BIT
                      00463 
Message[305]: Using default destination of 1 (file).
0097   0BBE           00464         DECFSZ  CONTADOR_START_BIT      ; VERIFICA SE HOUVE APENAS UM ESTOURO NO TIMER 0 NA SUBIDA DO ST
                            ART BIT
0098   28F6           00465         GOTO    SAI_INT                 ; SE HOUVE MAIS DE 1 OU MENOS, NÃO CARACTERIZA UM START BIT E SA
                            I DA INTERRUPÇÃO
0099   289A           00466         GOTO    START_BIT_LOW_INICIO            ; SE HOUVE APENAS 1 ESTOURO, CONTINUA A VERIFICAÇÃO PARA
                             O TEMPO EM LOW
                      00467 
                      00468         
009A                  00469 START_BIT_LOW_INICIO                    ; CODIGO PARECIDO COM A VERIFICAÇÃO DO TEMPO EM ALTA DO START BI
                            T
                      00470         ; BSF   GPIO, GP4
009A   110B           00471         BCF     INTCON, TMR0IF          ; MAS AGORA É TESTADO COM O TEMPO EM LOW
009B   30BA           00472         MOVLW   .186;.145               ; [X]
009C   0081           00473         MOVWF   TMR0
009D                  00474 START_BIT_LOW
009D   1806           00475         BTFSC   PORTB, RB0;GP2
009E   28F6           00476         GOTO    SAI_INT                 
009F   190B           00477         BTFSC   INTCON, TMR0IF
00A0   28A2           00478         GOTO    ESPERA_SUBIDA_START_BIT
00A1   289D           00479         GOTO    START_BIT_LOW
                      00480         
00A2                  00481 ESPERA_SUBIDA_START_BIT
00A2   110B           00482         BCF     INTCON, TMR0IF
00A3   30E1           00483         MOVLW   .225;.239;.225                  ; O TMR0 ESTOURARÁ A CADA 25 US [X]
00A4   0081           00484         MOVWF   TMR0
00A5                  00485 ESPERA_SUBIDA_ST        
00A5   1806           00486         BTFSC   PORTB, RB0;GP2
00A6   28AA           00487         GOTO    LER_BITS
00A7   190B           00488         BTFSC   INTCON, TMR0IF
00A8   28F6           00489         GOTO    SAI_INT                 ; SE O BARRAMENTO NÃO SUBIR NO INTERVALO DE TEMPO DADO, NÃO CARA
                            CTERIZA UM START BIT
00A9   28A5           00490         GOTO    ESPERA_SUBIDA_ST
                      00491         
                      00492 ;====================================
                      00493         
00AA                  00494 LER_BITS
                      00495         ;BSF    GPIO, GP2 ; APAGAR
00AA   110B           00496         BCF     INTCON, TMR0IF          ; LIMPA A FLAG DE ESTOURO DO TIMER ZERO
00AB   30F1           00497         MOVLW   .241;.232;.234          ; O TIMER ZERO ESTOURARÁ A CADA 30 US (BASE), QUANDO HOUVER O ES
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            TOURO, É VERIFICADO [X]
00AC   0081           00498         MOVWF   TMR0                    ; O ESTADO DO BARRAMENTO, SE O BARRAMENTO ESTIVER EM ALTA, SIGNI
                            FICA QUE O BARRAMENTO AINDA NÃO BAIXOU, OU SEJA, CARACTERIZA O BIT 1 (40(H)) > 30 US
00AD   30DC           00499         MOVLW   .220;.251;.248                  ; PASSA O VALOR PARA O MONITORA_BITS [X]
00AE   00B0           00500         MOVWF   MONITORA_BITS           ; QUANDO CHEGAR EM 255 ESTOURA
00AF                  00501 LER_BITS_CONTINUA                       ; CASO O BARRAMENTO ESTEJA EM LOW, SIGNIFICA QUE O BARRAMENTO JÁ
                             FOI PARA LOW, OU SEJA, O BIT LIDO É O ZERO (20(H) + 10(L)) = 30 US
                      00502         ;BTFSS  GPIO, GP2
                      00503         ;GOTO   VERIFICA_1_0
                      00504         ;BTFSC  INTCON, TMR0IF          ; VERIFICA SE HOUVE ESTOURO DO TIMER ZERO
                      00505         ;GOTO   VERIFICA_1_0            ; VERIFICA SE O BIT LIDO É ZERO OU UM
Message[305]: Using default destination of 1 (file).
00AF   0FB0           00506         INCFSZ  MONITORA_BITS           ; INCREMENTA, SE ESTOURAR, É SINAL QUE HOUVE ALGUM ERRO, E O PRO
                            GRAMA SAI
00B0   28B2           00507             GOTO    $+2                 ; SE NÃO ESTOURAR, CONTINUA
00B1   28F6           00508             GOTO    SAI_INT             ; SE ESTOURAR, SAI DA INTERRUPÇÃO
                      00509         
00B2   1806           00510         BTFSC   PORTB, RB0;GP2
00B3   28AF           00511             GOTO        LER_BITS_CONTINUA
00B4   28B5           00512             GOTO        VERIFICA_1_0
                      00513         
                      00514         
                      00515         
                      00516 ;INCREMENTA_CONTADOR_BITS
                      00517 ;       INCF    CONTADOR_TEMPO_BITS
                      00518 ;       GOTO    LER_BITS
00B5                  00519 VERIFICA_1_0                ; VERIFICA SE É O BIT 1 OU 0
00B5   1D0B           00520         BTFSS   INTCON, TMR0IF    ;GPIO, GP2
00B6   28B8           00521         GOTO    BIT_0
00B7   28C5           00522         GOTO    BIT_1
                      00523 
00B8                  00524 BIT_0
00B8   1003           00525         BCF     STATUS, C
Message[305]: Using default destination of 1 (file).
00B9   0D80           00526         RLF     INDF
                      00527         
                      00528         
                      00529         
Message[305]: Using default destination of 1 (file).
00BA   0BC0           00530         DECFSZ  CONTADOR_BITS           ; DECREMENTA O CONTADOR DE BITS 
00BB   28C2           00531         GOTO    ESPERA_BIT_0_MUDAR      ; SE NÃO FOR ZERO, ESPERA O BIT ZERO TERMINAR NO BARRAMENTO PARA
                             LEITURA DO PRÓXIMO
Message[305]: Using default destination of 1 (file).
00BC   0A84           00532         INCF    FSR                     ; SE ACABOU, INCREMENTA O PONTEIRO PARA O PROXIMO ENDEREÇO DE ME
                            MÓRIA       
                      00533         
                      00534         ;BSF    CONTADOR_BITS, 3        ; COLOCO O VALOR 8 NO CONTADOR DE BITS QUE ANTES ESTAVA ZERADO
00BD   3008           00535         MOVLW   .8
00BE   00C0           00536         MOVWF   CONTADOR_BITS
                      00537         
Message[305]: Using default destination of 1 (file).
00BF   0BBF           00538         DECFSZ  CONTADOR_BYTES          ; DECREMENTA O CONTADOR DE BYTES QUE TEM QUE SER LIDO
00C0   28C2           00539         GOTO    ESPERA_BIT_0_MUDAR      ; CASO NÃO SEJA ZERO, ESPERA O BIT ZERO TERMINAR NO BARRAMENTO P
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ARA LEITURA DO PRÓXIMO
00C1   28D2           00540         GOTO    CONCLUIDA_LEITURA       ; CASO SEJA ZERO, A LEITURA DOS DADOS DO BARRAMENTO ESTÁ FINALIZ
                            ADO.
                      00541         
00C2                  00542 ESPERA_BIT_0_MUDAR              
00C2   1C06           00543         BTFSS   PORTB, RB0;GP2
00C3   28C2           00544         GOTO    ESPERA_BIT_0_MUDAR
00C4   28AA           00545         GOTO    LER_BITS
                      00546 
00C5                  00547 BIT_1
00C5   1403           00548         BSF     STATUS, C
Message[305]: Using default destination of 1 (file).
00C6   0D80           00549         RLF     INDF
                      00550         
                      00551         
                      00552         
                      00553         
Message[305]: Using default destination of 1 (file).
00C7   0BC0           00554         DECFSZ  CONTADOR_BITS
00C8   28CF           00555         GOTO    ESPERA_BIT_1_MUDAR
Message[305]: Using default destination of 1 (file).
00C9   0A84           00556         INCF    FSR
                      00557         ;BSF    GPIO, GP4
                      00558         
                      00559         ;BSF    CONTADOR_BITS, 3        ; COLOCO O VALOR 8 NO CONTADOR DE BITS QUE ANTES ESTAVA ZERADO
00CA   3008           00560         MOVLW   .8
00CB   00C0           00561         MOVWF   CONTADOR_BITS
                      00562         
Message[305]: Using default destination of 1 (file).
00CC   0BBF           00563         DECFSZ  CONTADOR_BYTES
00CD   28CF           00564         GOTO    ESPERA_BIT_1_MUDAR
00CE   28D2           00565         GOTO    CONCLUIDA_LEITURA
                      00566         
00CF                  00567 ESPERA_BIT_1_MUDAR
                      00568         ;BTFSC  GPIO, GP2
                      00569         ;GOTO   ESPERA_BIT_1_MUDAR
                      00570 
00CF   1C06           00571         BTFSS   PORTB, RB0;GP2
00D0   28CF           00572         GOTO    $-1
00D1   28AA           00573         GOTO    LER_BITS
                      00574         
00D2                  00575 CONCLUIDA_LEITURA
                      00576         ;TESTA SE É PARA O DE COLISÃO
00D2   3002           00577         MOVLW   .2
00D3   0651           00578         XORWF   ENDERECO, 0
00D4   1903           00579         BTFSC   STATUS, Z
00D5   28E7           00580             GOTO    SALVA_COLISAO
                      00581             
                      00582         ;TESTA SE É PARA O DE SENSORES
00D6   3003           00583         MOVLW   .3
00D7   0651           00584         XORWF   ENDERECO, 0
00D8   1903           00585         BTFSC   STATUS, Z
00D9   28EA           00586             GOTO    SALVA_SENSORES
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00587             
                      00588         ;TESTA SE É PARA O DE DIREÇÃO
00DA   3004           00589         MOVLW   .4
00DB   0651           00590         XORWF   ENDERECO, 0
00DC   1903           00591         BTFSC   STATUS, Z
00DD   28ED           00592             GOTO    SALVA_DIRECAO
                      00593          
                      00594         ;TESTA SE É PARA O DE TRAÇÃO
00DE   3005           00595         MOVLW   .5
00DF   0651           00596         XORWF   ENDERECO, 0
00E0   1903           00597         BTFSC   STATUS, Z
00E1   28F0           00598             GOTO    SALVA_TRACAO
                      00599         
                      00600         ;TESTA SE É PARA O DE SINALIZAÇÃO
00E2   3006           00601         MOVLW   .6
00E3   0651           00602         XORWF   ENDERECO, 0
00E4   1903           00603         BTFSC   STATUS, Z
00E5   28F3           00604             GOTO    SALVA_SINALIZACAO
                      00605             
00E6   28F6           00606         GOTO    SAI_INT
                      00607         ;BSF    BARRAMENTO, 6   ; SINALIZA QUE A LEITURA FOI FINALIZADA
                      00608         ;BTFSC  DADO, 7
                      00609         ;    GOTO    COLISAO    ; SE HOUVER COLISÃO, TEM QUE LIGAR ALERTA, FREIO E PARAR
                      00610         ;BTFSS  PROPRIETARIO, 0 ; É MASTER?
                      00611         ;    GOTO    SAI_INT
                      00612             ;GOTO    PASSA_DADO_SINALIZACAO
                      00613         ;+BSF   PORTA, RA6
                      00614         ; TESTA SE O VALOR NO DADO É MENOR DO QUE 15 [ X01XXXXX ] -> ILUMINAÇÃO 
                      00615         ;MOVLW  B'01100000'     ; PASSA A MASCARA PARA O WORK PARA FAZER O AND
                      00616         ;ANDWF  DADO, 0         ; FAÇO O AND COM O DADO, PARA PEGAR SOMENTE OS BITS 5 E 6 E SALVAR NO WO
                            RK O RESULTADO
                      00617         ;XORLW  B'00100000'     ; FAÇO OUTRO XOR COM O WORK PARA CHECAR SE SOMENTE O BIT 5 É 1, CASO SEJ
                            A, O RESULTADO É ZERO
                      00618         ;BTFSS  DADO, 6         ; TESTA SE O BIT 6 ESTA EM 1
                      00619         ;    GOTO    TESTA_SENSORES     ; SE NÃO DEU, O VALOR NÃO INTERESSA AO SUBSISTEMA DE SINALIZAÇÃO
                      00620         ;    GOTO    PASSA_DADO_SINALIZACAO
                      00621 
00E7                  00622 SALVA_COLISAO
00E7   0852           00623         MOVF    DADO, W
00E8   00D9           00624         MOVWF   COLISAO
00E9   28F6           00625         GOTO    SAI_INT
00EA                  00626 SALVA_SENSORES
00EA   0852           00627         MOVF    DADO, W
00EB   00D8           00628         MOVWF   SENSORES
00EC   28F6           00629         GOTO    SAI_INT
00ED                  00630 SALVA_DIRECAO
00ED   0852           00631         MOVF    DADO, W
00EE   00D6           00632         MOVWF   DIRECAO
00EF   28F6           00633         GOTO    SAI_INT
00F0                  00634 SALVA_TRACAO
00F0   0852           00635         MOVF    DADO, W
00F1   00D5           00636         MOVWF   TRACAO
00F2   28F6           00637         GOTO    SAI_INT
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00F3                  00638 SALVA_SINALIZACAO
00F3   0852           00639         MOVF    DADO, W
00F4   00D7           00640         MOVWF   SINALIZACAO
00F5   28F6           00641         GOTO    SAI_INT
                      00642 
                      00643 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00644 ;*                 ROTINA DE SAÍDA DA INTERRUPÇÃO                  *
                      00645 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00646 ; OS VALORES DE "W" E "STATUS" DEVEM SER RECUPERADOS ANTES DE 
                      00647 ; RETORNAR DA INTERRUPÇÃO
                      00648 
00F6                  00649 SAI_INT
00F6   1614           00650         BSF             SSPCON, CKP                     ;LIBERA A LINHA SCL
00F7   01BC           00651         CLRF    CONTADOR_START_SYNC
00F8   01BE           00652         CLRF    CONTADOR_START_BIT
00F9   108B           00653         BCF     INTCON, INTF            ; LIMPA QUE HOUVE INTERRUPÇÃO DO RB0
00FA   10B7           00654         BCF     BARRAMENTO, 1
00FB   10B7           00655         BCF     FLAG_COLISAO
00FC   11B7           00656         BCF     FLAG_COL_START_BIT
00FD   1337           00657         BCF     BARRAMENTO, 6           ; LIMPA A FLAG
00FE   16B7           00658         BSF     BARRAMENTO, 5
00FF   0825           00659         MOVF            FSR_TEMP, W
0100   0084           00660         MOVWF           FSR
0101   0E21           00661         SWAPF           STATUS_TEMP, W
0102   0083           00662         MOVWF           STATUS
0103   0EA0           00663         SWAPF           W_TEMP, F
0104   0E20           00664         SWAPF           W_TEMP, W
                      00665         ;MOVF           PCLATH_TEMP, W
                      00666         ;MOVWF          PCLATH
                      00667         ;BCF    BARRAMENTO, 4
                      00668         ;BCF    BARRAMENTO, 2
                      00669         ;CLRF   BARRAMENTO
                      00670         ;BCF    GPIO, GP4
                      00671 ;       BANK1
                      00672 ;       BSF     TRISB, 0        ; COLOCA O RB0 COMO ENTRADA (ALTA IMPEDANCIA)
                      00673 ;       BANK0
                      00674         
                      00675         ;SWAPF  STATUS_TEMP,W
                      00676         ;MOVWF  STATUS          ;MOVE STATUS_TEMP PARA STATUS
                      00677         ;SWAPF  W_TEMP,F
                      00678         ;SWAPF  W_TEMP,W        ;MOVE W_TEMP PARA W
0105   0009           00679         RETFIE
                      00680 
                      00681 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00682 ;*                       ROTINAS E SUBROTINAS                      *
                      00683 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00684 ; CADA ROTINA OU SUBROTINA DEVE POSSUIR A DESCRIÇÃO DE FUNCIONAMENTO
                      00685 ; E UM NOME COERENTE ÀS SUAS FUNÇÕES.
                      00686 
                      00687         
0106                  00688 LE_EEPROM
                      00689 ;LER DADO DA EEPROM, CUJO ENDEREÇO É INDICADO EM W
                      00690 ;DADO LIDO RETORNA EM W
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0106   397F           00691         ANDLW   .127            ;LIMITA ENDEREÇO MAX. 127
0107   1683           00692         BANK1                           ;ACESSO VIA BANK 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0108   008D           00693         MOVWF   EEADR           ;INDICA O END. DE LEITURA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0109   140C           00694         BSF             EECON1,RD       ;INICIA O PROCESSO DE LEITURA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
010A   080C           00695         MOVF    EEDATA,W        ;COLOCA DADO LIDO EM W
010B   1283           00696         BANK0                           ;POSICIONA PARA BANK 0
010C   0008           00697         RETURN
                      00698 
                      00699 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00700 ;*                     INICIO DO PROGRAMA                          *
                      00701 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00702         
                      00703         
010D                  00704 INICIO
                      00705         ;********************************************************************************************* 
                      00706 ; CONFIGURAR COMO ESCRAVO O MSSP
010D   1683           00707         BANK1
010E   3018           00708         MOVLW           B'00011000'             
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
010F   0487           00709         IORWF           TRISC, F        ; CONFIGURA PINOS SDA E SCL COMO ENTRADA
0110   1283           00710         BANK0
0111   3036           00711         MOVLW           B'00110110'     ; SLAVE MODE, 7 BIT ENDEREÇO
                      00712         ;MOVLW          B'00111110'     ; SLAVE MODE, 7 BIT ENDEREÇO, COM INTERRUPÇÃO NO START E STOP BI
                            T
0112   0094           00713         MOVWF           SSPCON          ; CONFIGURA COMO ESCRAVO O DISPOSITIVO
                      00714                                         ; HABILITA A PORTA SERIAL E CONFIGURA PINOS COMO SDA E SCL <5> 
                      00715                                         ; ATIVA MODO ESCRAVO COM 7 BITS DE ENDERECO <3:0>
0113   1683           00716         BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0114   0194           00717         CLRF            SSPSTAT         ; LIMPA REG SSPSTAT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0115   1794           00718         BSF             SSPSTAT, SMP    ; CONTROLE DE SLOW RATE DESABILITADO 
                      00719                                         ; NIVEIS DE ENTRADA CONFORME ESPECIFICADO 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0116   1011           00720         BCF             SSPCON2, SEN    ; CLOCK STRETCHING ATIVADO SOMENTE NA TRANSMISSAO <0>
                      00721 
0117   301E           00722         MOVLW           0x1E    ; W RECEBE ENDEREÇO 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0118   0093           00723         MOVWF           SSPADD          ; ENDEREÇO NO REGISTRADOR SSPADD
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0119   158C           00724         BSF             PIE1, SSPIE     ; LLIGA CHAVE INDIVIDUAL DE INTERRUPÇAO DO MÓDULO MSSP
                      00725 
011A   170B           00726         BSF             INTCON, PEIE    ; INTERRUPÇÃO DE PERIFERICOS ATIVADA
011B   178B           00727         BSF             INTCON, GIE     ; LIGA CHAVE GERAL DE INTERRUPÇÃO
                      00728         ;BANK0
                      00729 
                      00730         ;BANK1                  ;ALTERA PARA O BANCO 1
011C   30F1           00731         MOVLW   B'11110001'     ;CONFIGURA TODAS AS PORTAS DO GPIO (PINOS)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011D   0086           00732         MOVWF   TRISB           ;COMO SAÍDAS
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

011E   3020           00733         MOVLW   B'00100000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011F   0085           00734         MOVWF   TRISA           ; INICIALIZA PORTA
0120   3082           00735         MOVLW   B'10000010'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0121   0081           00736         MOVWF   OPTION_REG      ;DEFINE OPÇÕES DE OPERAÇÃO
0122   30D0           00737         MOVLW   B'11010000'
0123   008B           00738         MOVWF   INTCON          ;DEFINE OPÇÕES DE INTERRUPÇÕES
                      00739         ;CALL   3FFH
                      00740         ;MOVWF  OSCCAL
0124   3064           00741         MOVLW   .100
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0125   0092           00742         MOVWF   PR2             ; PERIODO DO PWM
0126   1283           00743         BANK0                   ;RETORNA PARA O BANCO
0127   300C           00744         MOVLW   B'00001100'
0128   0097           00745         MOVWF   CCP1CON
0129   3002           00746         MOVLW   PWM_FREIO      
012A   0095           00747         MOVWF   CCPR1L          ; DUTY CICLE
012B   3004           00748         MOVLW   B'00000100'     ; HABILITA O TIMER2
012C   0092           00749         MOVWF   T2CON           ; HABILITA O TIMER2
012D   3044           00750         MOVLW   'D'
012E   00D2           00751         MOVWF   DADO
012F   3045           00752         MOVLW   'E'
0130   00D1           00753         MOVWF   ENDERECO
0131   3042           00754         MOVLW   'B' 
0132   00D0           00755         MOVWF   BYTE_0
                      00756 
0133   3031           00757         MOVLW   B'00110001'
0134   0090           00758         MOVWF   T1CON           ; HABILITANDO O TIMER 1 - 1:8   
0135   3007           00759         MOVLW   B'00000111'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0136   009C           00760         MOVWF   CMCON           ;DEFINE O MODO DE OPERAÇÃO DO COMPARADOR ANALÓGICO
                      00761 ;       MOVLW   'I'
                      00762 ;       MOVWF   DADO_I2C
                      00763 ;       MOVLW   'L'
                      00764 ;       MOVWF   LUCAS1
                      00765 ;       MOVLW   'U'
                      00766 ;       MOVWF   LUCAS2
                      00767 ;       MOVLW   'C'
                      00768 ;       MOVWF   LUCAS3
                      00769 ;       MOVLW   'A'
                      00770 ;       MOVWF   LUCAS4
                      00771 ;       MOVLW   'S'
                      00772 ;       MOVWF   LUCAS5
                      00773 ;       MOVLW   ' '
                      00774 ;       MOVWF   LUCAS6
0137   1486           00775         BSF     PORTB, RB1
                      00776 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00777 ;*                     INICIALIZAÇÃO DAS VARIÁVEIS                 *
                      00778 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00779 
                      00780 ; * * * * * * * * * * * * * * * *
                      00781 ;*                     ROTINA PRINCIPAL                            *
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00782 ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                      00783 
                      00784 ; RB0 -> LER O BARRAMENTO E ESCREVE
                      00785 ;
                      00786 ; RB1 -> FAROL
                      00787 ; RB2 -> RÉ
                      00788 ; RB3 -> PWM -> FREIO
                      00789 ; RB4 -> SE
                      00790 ; RB5 -> SD
                      00791 ;
                      00792 
0138                  00793 MAIN
                      00794         ;BTFSC  BARRAMENTO, 7
                      00795         ;    GOTO    ENVIA
                      00796 ;       CALL    VERIFICA_BARRAMENTO
                      00797 ;       GOTO    ENVIA_DADOS
                      00798         
                      00799         
                      00800         
                      00801         
                      00802 ;       CALL DELAY10MS
                      00803 ;       CALL DELAY10MS
                      00804 ;       CALL DELAY100MS
                      00805 ;       CALL DELAY100MS
                      00806 ;       CALL DELAY100MS
                      00807 ;       CALL DELAY100MS
0138   1827           00808     BTFSC       MONITORA_SUBSISTEMAS, 0
0139   2940           00809         GOTO    ENVIA_DIRECAO
                      00810         
                      00811         
013A   222A           00812         CALL DELAY10MS
013B   1BB9           00813         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
013C   223B           00814             CALL    TRATA_L3
013D   1427           00815         BSF      MONITORA_SUBSISTEMAS, 0
013E   3010           00816         MOVLW   .16         ; CODIGO DE REQUISIÇÃO DOS SENSORES
013F   2975           00817         GOTO    ENVIA
                      00818 ;======================================================================================
0140                  00819 ENVIA_DIRECAO
0140   18A7           00820         BTFSC   MONITORA_SUBSISTEMAS, 1
0141   2948           00821             GOTO        ENVIA_TRACAO
0142   222A           00822         CALL DELAY10MS
                      00823         
                      00824         
0143   1BB9           00825         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
0144   223B           00826             CALL    TRATA_L3
0145   14A7           00827         BSF      MONITORA_SUBSISTEMAS, 1
0146   3007           00828         MOVLW   .7          ; CODIGO DE REQUISIÇÃO DA DIREÇÃO
0147   2975           00829         GOTO    ENVIA
                      00830 ;======================================================================================
0148                  00831 ENVIA_TRACAO     
0148   1927           00832         BTFSC   MONITORA_SUBSISTEMAS, 2
0149   2950           00833             GOTO        ENVIA_SENSORES
014A   222A           00834         CALL DELAY10MS
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00835         
                      00836         
014B   1BB9           00837         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
014C   223B           00838             CALL    TRATA_L3
014D   1527           00839         BSF      MONITORA_SUBSISTEMAS, 2
014E   300D           00840         MOVLW   .13         ; CODIGO DE REQUISIÇÃO DA TRAÇÃO
014F   2975           00841         GOTO    ENVIA
                      00842 ;======================================================================================
0150                  00843 ENVIA_SENSORES  
0150   19A7           00844         BTFSC   MONITORA_SUBSISTEMAS, 3
0151   2958           00845             GOTO        ENVIA_DIRECAO_2
0152   222A           00846         CALL DELAY10MS
                      00847         
0153   1BB9           00848         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
0154   223B           00849             CALL    TRATA_L3
0155   15A7           00850         BSF      MONITORA_SUBSISTEMAS, 3
0156   3010           00851         MOVLW   .16         ; CODIGO DE REQUISIÇÃO DOS SENSORES
0157   2975           00852         GOTO    ENVIA
                      00853 ;======================================================================================
0158                  00854 ENVIA_DIRECAO_2  
0158   1A27           00855         BTFSC   MONITORA_SUBSISTEMAS, 4
0159   2960           00856             GOTO        ENVIA_TRACAO_2
015A   222A           00857         CALL DELAY10MS
                      00858         
015B   1BB9           00859         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
015C   223B           00860             CALL    TRATA_L3
015D   1627           00861         BSF      MONITORA_SUBSISTEMAS, 4
015E   3007           00862         MOVLW   .7          ; CODIGO DE REQUISIÇÃO DA DIREÇÃO
015F   2975           00863         GOTO    ENVIA
                      00864 ;======================================================================================
0160                  00865 ENVIA_TRACAO_2    
0160   1AA7           00866         BTFSC   MONITORA_SUBSISTEMAS, 5
0161   2968           00867             GOTO        ENVIA_SINALIZACAO
                      00868         
0162   222A           00869         CALL DELAY10MS
0163   1BB9           00870         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
0164   223B           00871             CALL    TRATA_L3
0165   16A7           00872         BSF      MONITORA_SUBSISTEMAS, 5
0166   300D           00873         MOVLW   .13         ; CODIGO DE REQUISIÇÃO DA TRAÇÃO
0167   2975           00874         GOTO    ENVIA
                      00875 ;======================================================================================
0168                  00876 ENVIA_SINALIZACAO
0168   1B27           00877         BTFSC   MONITORA_SUBSISTEMAS, 6
0169   2970           00878             GOTO        LIMPA_MONITORIA
                      00879         
016A   222A           00880         CALL DELAY10MS    
                      00881 
                      00882         
016B   1BB9           00883         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
016C   223B           00884             CALL    TRATA_L3
016D   1727           00885         BSF      MONITORA_SUBSISTEMAS, 6
016E   3060           00886         MOVLW   .96         ; CODIGO DE REQUISIÇÃO DA SINALIZAÇÃO
016F   2975           00887         GOTO    ENVIA
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0170                  00888 LIMPA_MONITORIA
0170   01A7           00889             CLRF    MONITORA_SUBSISTEMAS
                      00890             
                      00891 ;   TODO
                      00892     ; PEDE REQUISICAO DOS SENSORES (OBS*) [ TESTA SE FAZ TEMPO QUE ENVIOU, AI PEDE CASO TENHA DEMORADO ]
                             
                      00893         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00894     ; PEDE REQUISIÇÃO DA DIREÇÃO
                      00895     ;MOVLW  REQUISIÇÃO DA DIREÇÃO
                      00896     ;GOTO    ENVIA
                      00897     
                      00898         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00899     ; PEDE REQUISIÇÃO DA TRAÇÃO
                      00900         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00901     ; PEDE REQUISIÇÃO DOS SENSORES (OBS*)
                      00902         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00903     ; PEDE REQUISIÇÃO DA DIREÇÃO
                      00904         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00905     ; PEDE REQUISIÇÃO DA TRAÇÃO
                      00906         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00907     ; PEDE REQUISIÇÃO DA SINALIZAÇÃO
                      00908         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      00909         
                      00910     ; OBS* TALVEZ NÃO PRECISE DA REQUISIÇÃO DOS SENSORES, POIS ELES IRÃO ENVIAR A CADA MUDANÇA DE ESTADO
                      00911     ; TALVEZ PRECISE PARA SABER SE ESTA FUNCIONANDO?
                      00912     
                      00913     ; REINICIA O CIRCULO DE REQUISIÇÕES, SO É INTERROMPIDO CASO HAJA UM DADO DO I2C
                      00914         
                      00915         
                      00916         
0171   1BB9           00917         BTFSC       CONT_BYTES_I2C, 7           ; VERIFICA SE FOI ENVIADO UM PACOTE DO L3
0172   223B           00918             CALL    TRATA_L3
                      00919             ;GOTO    ENVIA
                      00920         
0173   1505           00921         BSF         PORTA, 2
                      00922 ;       BANK1
                      00923 ;       BTFSC       SSPSTAT, P      ; TESTA SE HOUVE UM STOP BIT
                      00924 ;           GOTO    ENVIA
                      00925 ;       BANK0
0174   2938           00926         GOTO    MAIN
                      00927         ;GOTO   MAIN
0175                  00928 ENVIA
                      00929         
                      00930         ;CALL   DELAY10MS
0175   00A6           00931         MOVWF   W_AUX
0176   13B9           00932         BCF     CONT_BYTES_I2C, 7
0177   1283           00933         BANK0
0178   2184           00934         CALL    VERIFICA_BARRAMENTO
0179   0826           00935         MOVF    W_AUX, W
017A   2992           00936         GOTO    ENVIA_DADOS
017B   2938           00937         GOTO MAIN
                      00938         
                      00939 ;#########################################################################################
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

017C                  00940 FIM_ENVIA_DADOS
                      00941 ;       BANK1
                      00942 ;       BCF     SSPSTAT, P      ; LIMPA A FLAG DO STOP BIT
                      00943 ;       BANK0
                      00944         ;BCF    BARRAMENTO, 7
017C   1614           00945         BSF             SSPCON, CKP                     ;LIBERA A LINHA SCL
017D   0825           00946         MOVF    FSR_TEMP, W 
017E   0084           00947         MOVWF   FSR
017F   108B           00948         BCF     INTCON, INTF
0180   178B           00949         BSF     INTCON, GIE
0181   1837           00950         BTFSC   BARRAMENTO, 0
0182   2975           00951             GOTO    ENVIA
0183   2938           00952         GOTO    MAIN
                      00953 ;=============================================================
0184                  00954 VERIFICA_BARRAMENTO             ; VERIFICO SE O BARRAMENTO ESTÁ LIVRE POR 200 US
                      00955         ;BSF    PORTA, RA7
0184   178B           00956         BSF     INTCON, GIE     ; HABILITO A INTERRUPÇÃO
0185   12B7           00957         BCF     BARRAMENTO, 5   ; LIMPA O SINALIZADOR DE LEITURA DO BARRAMENTO
                      00958         ; TESTA SE O VALOR LIDO É REFERENTE AO STOP DA COLISAO
                      00959         ;   SE FOR, TRATAR ESSE DADO
0186   110B           00960         BCF     INTCON, T0IF
0187   30D0           00961         MOVLW   .208;.40;.20
0188   0081           00962         MOVWF   TMR0
0189   1C06           00963         BTFSS   PORTB, RB0              ; VERIFICA SE O BARRAMENTO ESTÁ EM LOW
018A   2984           00964          GOTO   VERIFICA_BARRAMENTO
                      00965         
018B                  00966 VERIFICA_BARRAMENTO_0
018B   1C06           00967         BTFSS   PORTB, RB0              ; VERIFICA SE O BARRAMENTO ESTÁ EM LOW
018C   2984           00968          GOTO   VERIFICA_BARRAMENTO
018D   1D0B           00969         BTFSS   INTCON, T0IF
018E   298B           00970         GOTO    VERIFICA_BARRAMENTO_0
                      00971         ;BSF    BARRAMENTO, 0      ; SINALIZO BARRAMENTO LIVRE. (É NECESSÁRIO?)
018F   1AB7           00972         BTFSC   BARRAMENTO, 5   ; HOUVE UMA LEITURA NO BARRAMENTO?
0190   2984           00973          GOTO   VERIFICA_BARRAMENTO
                      00974         ;BCF    PORTA, RA7
0191   0008           00975         RETURN
                      00976 ;=============================================================
0192                  00977 ENVIA_DADOS
0192   1214           00978               BCF       SSPCON, CKP                     ; NAO, LIBERA A LINHA SCL
                      00979 ;               BTFSC   PORTA, RA7
                      00980 ;                   GOTO    FIM_ENVIA_DADOS
0193   138B           00981               BCF       INTCON, GIE             ; DESABILITA AS INTERRUPÇÕES
                      00982 ;             BCF       INTCON, PEIE
                      00983         ;=========================================
0194   00E2           00984               MOVWF     DADO_1      ; O QUE TIVER NO WORK VAI SER O DADO A SER ENVIADO
                      00985                                     ; O DADO CONTERÁ A REQUISIÇÃO PARA CADA UM DOS SUBSISTEMAS
                      00986         ;=========================================
0195   0804           00987               MOVF      FSR, W
0196   00A5           00988               MOVWF     FSR_TEMP
                      00989 ;             BCF       INTCON, INTE
                      00990 ;             BCF       INTCON, RBIE
                      00991               
                      00992 
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0197   01C1           00993         CLRF    ESTAGIO
                      00994         ;CLRF   INTCON              ;   DESABILITA A INTERRUPÇÃO
                      00995         ;MOVLW  0X00
0198   3003           00996         MOVLW   0X03
0199   00E0           00997         MOVWF   BYTE_0_1
019A   3000           00998         MOVLW   0X00
019B   00E1           00999         MOVWF   ENDERECO_1
019C   1683           01000         BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
019D   0813           01001         MOVF    SSPADD, W
019E   1283           01002         BANK0
                      01003         ;MOVWF  DADO_1
                      01004         
                      01005         
                      01006         
                      01007         ;MOVF   ENDERECO_SINALIZACAO, W  ;      MOVO O ENDEREÇO DO SUBSISTEMA QUE ENVIARÁ DOS DADOS
                      01008         ;MOVWF  ENDERECO            ;   PARA O ENDEREÇO QUE SERÁ LIDO
                      01009         ;MOVF   ESTADO_SINALIZACAO, W
                      01010         ;MOVWF  DADO
                      01011         ;GOTO   ENVIAR_OK
                      01012 
                      01013         
019F                  01014 ENVIAR_OK
019F   1437           01015             BSF         BARRAMENTO, 0
01A0   305F           01016             MOVLW       0x5F                    ; ENDEREÇO APONTADO PARA O ENREREÇO RESERVADO PARA LEITU
                            RA DOS DADOS 
                      01017                                                 ; PARA SER INCREMENTADO POR IGUAL NO ENVIO DOS BYTES
01A1   0084           01018             MOVWF       FSR                     ; PONTEIRO
01A2   3003           01019             MOVLW       .3
01A3   00BF           01020             MOVWF       CONTADOR_BYTES
                      01021             
01A4   1C06           01022             BTFSS       PORTB, RB0              ; TESTE
01A5   2938           01023                GOTO     MAIN
                      01024             
01A6   2209           01025             CALL        START_SYNC_MASTER       ; PASSA 250 US EM BAIXA, NÃO NECESSITA VERIFICAR COLISÃO
01A7   29C7           01026             GOTO        START_BIT_ENVIA
01A8                  01027 FIM_START_BIT
Message[305]: Using default destination of 1 (file).
01A8   0A84           01028                 INCF    FSR                 ; VALOR INCREMENTADO DO PONTEIRO, PARA QUE EM TODOS OS TEMPO
                            S SEJAM IGUAIS
                      01029         ;BSF    CONTADOR_BITS, 3        ; COLOCO O VALOR 8 NO CONTADOR DE BITS QUE ANTES ESTAVA ZERADO
01A9   3008           01030                 MOVLW   .8
01AA   00C0           01031                 MOVWF   CONTADOR_BITS
01AB   14C1           01032                 BSF     ESTAGIO, 1          ; SINALIZA QUE É O ENVIO DO BYTE 0
01AC   29D3           01033                 GOTO    ENVIA_BYTE          ; O VALOR QUE ESTIVER NO WORK, SERÁ ENVIADO
01AD                  01034 FIM_BYTE_0
01AD   3010           01035                 MOVLW   .16                     ; DELAY EM US
01AE   2235           01036                 CALL    DELAY_MICRO
Message[305]: Using default destination of 1 (file).
01AF   0D80           01037                 RLF     INDF                ; ULTIMO ROTATE PARA QUE PEGAR O VALOR QUE ESTAVA NO CARRY E
                             DEIXAR ORIGINAL
Message[305]: Using default destination of 1 (file).
01B0   03BF           01038                 DECF    CONTADOR_BYTES      ; DECREMENTA O CONTADOR DE BYTES TODA VEZ QUE É ENVIADO UM B
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            YTE
Message[305]: Using default destination of 1 (file).
01B1   0A84           01039                 INCF    FSR                 ; VALOR INCREMENTADO DO PONTEIRO, PARA QUE EM TODOS OS TEMPO
                            S SEJAM IGUAIS
                      01040         ;BSF    CONTADOR_BITS, 3        ; COLOCO O VALOR 8 NO CONTADOR DE BITS QUE ANTES ESTAVA ZERADO
01B2   3008           01041                 MOVLW   .8
01B3   00C0           01042                 MOVWF   CONTADOR_BITS
01B4   1541           01043                 BSF     ESTAGIO, 2          ; SINALIZA QUE É O ENVIO DO ENDEREÇO
01B5   29D3           01044                 GOTO    ENVIA_BYTE          ; O VALOR QUE ESTIVER NO WORK, SERÁ ENVIADO
01B6                  01045 FIM_ENDERECO
01B6   3010           01046                 MOVLW   .16                     ; DELAY EM US
01B7   2235           01047                 CALL    DELAY_MICRO
Message[305]: Using default destination of 1 (file).
01B8   0D80           01048                 RLF     INDF                ; ULTIMO ROTATE PARA QUE PEGAR O VALOR QUE ESTAVA NO CARRY E
                             DEIXAR ORIGINAL
Message[305]: Using default destination of 1 (file).
01B9   03BF           01049                 DECF    CONTADOR_BYTES      ; DECREMENTA O CONTADOR DE BYTES TODA VEZ QUE É ENVIADO UM B
                            YTE
Message[305]: Using default destination of 1 (file).
01BA   0A84           01050                 INCF    FSR                 ; VALOR INCREMENTADO DO PONTEIRO, PARA QUE EM TODOS OS TEMPO
                            S SEJAM IGUAIS
                      01051                         ;BSF    CONTADOR_BITS, 3        ; COLOCO O VALOR 8 NO CONTADOR DE BITS QUE ANTES
                             ESTAVA ZERADO
01BB   3008           01052                 MOVLW   .8
01BC   00C0           01053                 MOVWF   CONTADOR_BITS
01BD   15C1           01054                 BSF     ESTAGIO, 3          ; SINALIZA QUE É O ENVIO DO DADO
01BE   29D3           01055                 GOTO    ENVIA_BYTE          ; O VALOR QUE ESTIVER NO WORK, SERÁ ENVIADO
01BF                  01056 FIM_DADO
01BF   3010           01057                 MOVLW   .16                     ; DELAY EM US
01C0   2235           01058                 CALL    DELAY_MICRO
Message[305]: Using default destination of 1 (file).
01C1   0D80           01059                 RLF     INDF                ; ULTIMO ROTATE PARA QUE PEGAR O VALOR QUE ESTAVA NO CARRY E
                             DEIXAR ORIGINAL
Message[305]: Using default destination of 1 (file).
01C2   03BF           01060                 DECF    CONTADOR_BYTES      ; DECREMENTA O CONTADOR DE BYTES TODA VEZ QUE É ENVIADO UM B
                            YTE
01C3   2214           01061                 CALL    DELAY_US
01C4   1486           01062                 BSF     PORTB, RB1          ; COLOCA O BARRAMENTO EM ALTA
                      01063                 
                      01064                 ; TODO
                      01065                 ; SE O DADO ENVIADO FOR PARA RECALL, FAZ UM GOTO PARA O FIM_ENDERECO MANDANDO O VALOR DO
                             ULTIMO BYTE, O DADO PARA O SUBSISTEMA.
                      01066                 
01C5   1037           01067                 BCF             BARRAMENTO, 0
                      01068 
                      01069 ;               BTFSC   BARRAMENTO, 7       ; OS DADOS ENVIADOS ERAM DOS SENSORES?
                      01070 ;                   GOTO    ENVIOU_SENSORES ; TRATA
                      01071 ;               BTFSC   REQUISICAO
                      01072 ;                   GOTO    REQUISICAO_ENVIADA
01C6   297C           01073                 GOTO    FIM_ENVIA_DADOS
                      01074 ;REQUISICAO_ENVIADA
                      01075 ;               ;BCF    REQUISICAO          ; QUANDO HOUVER UMA REQUISIÇÃO, ENVIA UMA UNICA VEZ O DADO
                      01076 ;               MOVF    ESTADO_SINALIZACAO, W
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01077 ;               MOVWF   DADO_SINALIZACAO
                      01078 ;               GOTO    FIM_ENVIA_DADOS
                      01079 ;ENVIOU_SENSORES
                      01080 ;               BCF     BARRAMENTO, 7
                      01081 ;               GOTO    FIM_ENVIA_DADOS     ; CASO TAMBÉM TENHA TIDO UMA REQUISIÇÃO, O BIT DE REQUISIÇÃO
                             NÃO FOI LIMPO
                      01082 ;                                           ; LOGO, O DADO SERÁ REENVIADO.
                      01083         
01C7                  01084 START_BIT_ENVIA
                      01085         ;DELAY DE 50 US EM ALTA
01C7   1486           01086         BSF     PORTB, RB1
01C8   3032           01087         MOVLW   .50
01C9   2235           01088         CALL DELAY_MICRO
01CA   1486           01089         BSF     PORTB, RB1
01CB   1C06           01090         BTFSS   PORTB, RB0;GP2
01CC   29FB           01091             GOTO    COLISAO_START_BIT   ; SE HOUVER COLISÃO, TRATAR OS DADOS REFENTE A ELA
01CD   3064           01092         MOVLW   .100
01CE   2235           01093         CALL DELAY_MICRO
                      01094 
                      01095         ; DELAY DE 150 US EM BAIXA, NÃO NECESSITA VERIFICAR COLISÃO
01CF   1086           01096         BCF     PORTB, RB1
01D0   3096           01097         MOVLW   .150
01D1   2235           01098         CALL    DELAY_MICRO
                      01099         
01D2   29A8           01100         GOTO    FIM_START_BIT
                      01101         
                      01102 
01D3                  01103 ENVIA_BYTE 
01D3   1F80           01104     BTFSS   INDF, 7
01D4   29D6           01105         GOTO    ENVIA_0
01D5   29E2           01106         GOTO    ENVIA_1
                      01107 
01D6                  01108 ENVIA_0
                      01109 
01D6   1486           01110         BSF     PORTB, RB1
                      01111         ;CALL   DELAY_US
01D7   3013           01112         MOVLW   .19                 ; DELAY DE 19 US
01D8   2235           01113         CALL    DELAY_MICRO
Message[305]: Using default destination of 1 (file).
01D9   0D80           01114         RLF     INDF        
                      01115         
Message[305]: Using default destination of 1 (file).
01DA   0BC0           01116         DECFSZ  CONTADOR_BITS
01DB   29F7           01117             GOTO    TEMPO_EM_BAIXA      ; VAI PASSAR 20 US EM BAIXA
01DC   1086           01118             BCF     PORTB, RB1          ; FICA EM BAIXA O BARRAMENTO
                      01119 ;       BANK1
                      01120 ;       BCF     TRISB, 0    ; SAIDA, BARRAMENTO EM BAIXA
                      01121 ;       BANK0
01DD   19C1           01122             BTFSC   ESTAGIO, 3          ; VERIFICA SE TERMINOU DE ENVIAR O DADO
01DE   29BF           01123                 GOTO    FIM_DADO
01DF   1941           01124             BTFSC   ESTAGIO, 2          ; VERIFICA SE TERMINOU DE ENVIAR O ENDERECO
01E0   29B6           01125                 GOTO    FIM_ENDERECO
01E1   29AD           01126                 GOTO    FIM_BYTE_0      ; CASO NÃO ESTEJA NENHUM, O BYTE ENVIADO É BYTE_0
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01127 
01E2                  01128 ENVIA_1
01E2   1486           01129         BSF     PORTB, RB1
Message[305]: Using default destination of 1 (file).
01E3   0D80           01130         RLF     INDF    
                      01131         ; PASSA 30 US EM ALTA
                      01132 ;       BTFSS   PORTB, RB0;GP2          ; TESTA SE O BARRAMENTO NÃO ESTÁ COM COLISÃO
                      01133 ;           GOTO    FIM_ENVIA_DADOS     ; TRATAR COLISAO BITS
                      01134             
01E4   3003           01135         MOVLW   .3                      ; DELAY EM US
01E5   2235           01136         CALL    DELAY_MICRO
01E6   1486           01137         BSF     PORTB, RB1
01E7   1C06           01138         BTFSS   PORTB, RB0;GP2
01E8   297C           01139             GOTO    FIM_ENVIA_DADOS     ; SE HOUVER COLISÃO NESSE PONTO, É ERRO, NÃO DEVERIA TER, TRATAR
                             OS DADOS REFENTE A ELA
01E9   301A           01140         MOVLW   .26                     ; DELAY EM US
01EA   2235           01141         CALL    DELAY_MICRO
01EB   1C06           01142         BTFSS   PORTB, RB0;GP2
01EC   2A00           01143             GOTO    COLISAO_ENVIAR_BITS ; SE HOUVER COLISÃO, TRATAR OS DADOS REFENTE A ELA
                      01144             
01ED   3006           01145         MOVLW   .6                      ; DELAY EM US
01EE   2235           01146         CALL    DELAY_MICRO
                      01147         
Message[305]: Using default destination of 1 (file).
01EF   0BC0           01148         DECFSZ  CONTADOR_BITS
01F0   29F7           01149             GOTO    TEMPO_EM_BAIXA      ; VAI PASSAR 20 US EM BAIXA
01F1   1086           01150             BCF     PORTB, RB1          ; FICA EM BAIXA O BARRAMENTO
01F2   19C1           01151             BTFSC   ESTAGIO, 3          ; VERIFICA SE TERMINOU DE ENVIAR O DADO
01F3   29BF           01152                 GOTO    FIM_DADO
01F4   1941           01153             BTFSC   ESTAGIO, 2          ; VERIFICA SE TERMINOU DE ENVIAR O ENDERECO
01F5   29B6           01154                 GOTO    FIM_ENDERECO
01F6   29AD           01155                 GOTO    FIM_BYTE_0      ; CASO NÃO ESTEJA NENHUM, O BYTE ENVIADO É BYTE_0
                      01156 ;==============================
01F7                  01157 TEMPO_EM_BAIXA
                      01158 ;       BANK1
                      01159 ;       BCF     TRISB, 0    ; SAIDA, BARRAMENTO EM BAIXA
                      01160 ;       BANK0
01F7   1086           01161         BCF     PORTB, RB1
                      01162         ; PASSA 20 US EM BAIXA
                      01163         ;CALL   DELAY_US
                      01164         
01F8   3014           01165         MOVLW   .20                     ; DELAY EM US
01F9   2235           01166         CALL    DELAY_MICRO
                      01167         
01FA   29D3           01168         GOTO    ENVIA_BYTE
                      01169 ;===============================
01FB                  01170 COLISAO_START_BIT
                      01171         
01FB   15B7           01172         BSF     FLAG_COL_START_BIT              ; SINALIZO QUE HOUVE UMA COLISÃO NO START BIT
01FC   14B7           01173         BSF     FLAG_COLISAO            ; SINALIZO QUE HOUVE UMA COLISÃO
                      01174         
                      01175         ;MOVLW  B'11011000'
01FD   178B           01176         BSF     INTCON, GIE                             ;   ATIVAR AS INTERRUPÇÕES
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01FE   148B           01177         BSF     INTCON, INTF                            ; SINALIZO A INTERRUPÇÃO PARA QUE SEJA TRATADA I
                            MEDIATAMENTE
01FF   2938           01178         GOTO    MAIN
                      01179         
0200                  01180 COLISAO_ENVIAR_BITS                                                             
0200   1380           01181         BCF     INDF,   7                               ; SETO O BIT DO REGISTRADOR APONTADO PARA 0, POI
                            S HOUVE COLISAO 
                      01182         ;BCF    PORTB, RB1
0201   0BC0           01183         DECFSZ  CONTADOR_BITS, F                        ; TEM QUE DECREMENTAR O CONTADOR DE BITS, POIS E
                            LE FOI LIDO JÁ E SERA LIDO OUTRA VEZ CASO NÃO DECREMENTE
0202   2A04           01184             GOTO        $+2
0203   2938           01185             GOTO        MAIN
0204   1637           01186         BSF     FLAG_COL_ENVIAR_BIT                     ; SINALIZO QUE HOUVE UMA COLISÃO NO START BIT NO
                             REGISTRADOR BARRAMENTO
0205   14B7           01187         BSF     FLAG_COLISAO                            ; SINALIZO QUE HOUVE UMA COLISÃO
                      01188         ;MOVLW  B'11011000'
0206   178B           01189         BSF     INTCON, GIE                                     ;   ATIVAR AS INTERRUPÇÕES
0207   148B           01190         BSF     INTCON, INTF                            ; SINALIZO A INTERRUPÇÃO PARA QUE SEJA TRATADA I
                            MEDIATAMENTE
0208   2938           01191         GOTO    MAIN
                      01192 ;====================================
0209                  01193 START_SYNC_MASTER                       ; START SYNC DE 500 US [MASTER]
0209   1086           01194         BCF     PORTB, RB1              ;2493 cycles
020A   30F2           01195         MOVLW   0xF2
020B   00BA           01196         MOVWF   d1
020C   3002           01197         MOVLW   0x02
020D   00BB           01198         MOVWF   d2
020E                  01199 START_SYNC_MASTER_0
020E   0BBA           01200         DECFSZ  d1, f
020F   2A11           01201         GOTO    $+2
0210   0BBB           01202         DECFSZ  d2, f
0211   2A0E           01203         GOTO    START_SYNC_MASTER_0
                      01204 
                      01205                         ;3 cycles
                      01206         ;GOTO   $+1
                      01207         ;nop
0212   1486           01208         BSF     PORTB, RB1
                      01209 
                      01210                         ;4 cycles (including call)
0213   0008           01211         RETURN
                      01212 ;START_SYNC_SLAVE
                      01213 ;;      BANK1
                      01214 ;;      BCF     TRISB, 0    ; SAIDA
                      01215 ;;      BANK0
                      01216 ;       BCF     PORTB, RB1
                      01217 ;       ; PASSA 250 US EM BAIXA
                      01218 ;                       ;244 cycles
                      01219 ;       MOVLW   .82
                      01220 ;       MOVWF   DELAY_SYNC
                      01221 ;START_SYNC_SLAVE_0
                      01222 ;       DECFSZ  DELAY_SYNC, F
                      01223 ;       GOTO    START_SYNC_SLAVE_0
                      01224 ;       
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01225 ;       ;GOTO   $+1
                      01226 ;       BSF     PORTB, RB1
                      01227 ;;      BANK1
                      01228 ;;      BSF     TRISB, 0 ; ENTRADA, BARRAMENTO VAI PRA 1
                      01229 ;;      BANK0
                      01230 ;       RETURN
                      01231 
0214                  01232 DELAY_US
0214   0000           01233     NOP
0215   0000           01234     NOP
0216   0000           01235     NOP
0217   0000           01236     NOP
0218   0000           01237     NOP
0219   0000           01238     NOP
021A   0000           01239     NOP
021B   0000           01240     NOP
021C   0000           01241     NOP
021D   0000           01242     NOP
                      01243     
021E   0008           01244     RETURN
021F                  01245 DELAY100MS
                      01246                         ;99993 cycles
021F   301E           01247         MOVLW   .30
0220   00B6           01248         MOVWF   CONT_1
0221   304F           01249         MOVLW   .79
0222   00B5           01250         MOVWF   CONT_2
0223                  01251 DELAY100MS_0
Message[305]: Using default destination of 1 (file).
0223   0BB6           01252         DECFSZ  CONT_1
0224   2A26           01253         GOTO    $+2
Message[305]: Using default destination of 1 (file).
0225   0BB5           01254         DECFSZ  CONT_2
0226   2A23           01255         GOTO    DELAY100MS_0
                      01256                         ;3 cycles
0227   2A28           01257         GOTO    $+1
0228   0000           01258         NOP
                      01259                         ;4 cycles (including call)
0229   0008           01260         RETURN
                      01261         
                      01262 ;#########################################################################################
022A                  01263 DELAY10MS
                      01264                         ;49993 cycles
022A   300E           01265         MOVLW   0x0E
022B   00BA           01266         MOVWF   d1
022C   3028           01267         MOVLW   0x28
022D   00BB           01268         MOVWF   d2
022E                  01269 DELAY10MS_0
022E   0BBA           01270         DECFSZ  d1, f
022F   2A31           01271         GOTO    $+2
0230   0BBB           01272         DECFSZ  d2, f
0231   2A2E           01273         GOTO    DELAY10MS_0
                      01274 
                      01275                         ;3 cycles
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0232   2A33           01276         GOTO    $+1
0233   0000           01277         NOP
                      01278 
                      01279                         ;4 cycles (including call)
0234   0008           01280         RETURN
0235                  01281 DELAY_MICRO
0235   00C4           01282     MOVWF   TEMPO0                  ; CARREGA EM TEMPO_1 ATE AONDE VAI ESPERAR
0236   0000           01283     NOP
0237   0000           01284     NOP
0238   0BC4           01285     DECFSZ  TEMPO0,F            ; SE PASSOU O TEMPO?
0239   2A36           01286     GOTO    $-3                         ; NÃO, VOLTA
023A   0008           01287     RETURN
                      01288     
                      01289     
                      01290 ;   TODO
                      01291     ; PEDE REQUISICAO DOS SENSORES (OBS*) [ TESTA SE FAZ TEMPO QUE ENVIOU, AI PEDE CASO TENHA DEMORADO ]
                             
                      01292         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01293     ; PEDE REQUISIÇÃO DA DIREÇÃO
                      01294     ;MOVLW  REQUISIÇÃO DA DIREÇÃO
                      01295     ;GOTO    ENVIA
                      01296     
                      01297         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01298     ; PEDE REQUISIÇÃO DA TRAÇÃO
                      01299         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01300     ; PEDE REQUISIÇÃO DOS SENSORES (OBS*)
                      01301         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01302     ; PEDE REQUISIÇÃO DA DIREÇÃO
                      01303         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01304     ; PEDE REQUISIÇÃO DA TRAÇÃO
                      01305         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01306     ; PEDE REQUISIÇÃO DA SINALIZAÇÃO
                      01307         ; ESPERA POR X MS A RESPOSTA E SALVA NO SEU BYTE CORRESPONDENTE 
                      01308         
                      01309     ; OBS* TALVEZ NÃO PRECISE DA REQUISIÇÃO DOS SENSORES, POIS ELES IRÃO ENVIAR A CADA MUDANÇA DE ESTADO
                      01310     ; TALVEZ PRECISE PARA SABER SE ESTA FUNCIONANDO?
                      01311     
                      01312     ; REINICIA O CIRCULO DE REQUISIÇÕES, SO É INTERROMPIDO CASO HAJA UM DADO DO I2C
                      01313     
                      01314     ; QUANDO HOUVER UM DADO DO I2C, PODE SER OS SEGUINTES
                      01315         ;CÓDIGO
                      01316         
                      01317         ; 83 - SSP - MOTORISTA PEDE O ESTADO DOS SUBSISTEMAS
                      01318             ; 0 | 0XFF | 0XFF | 0XFF | 0XFF | 0XFF
                      01319             
                      01320         ; 80 - RSP - CARRO RESPONDE O ESTADO DOS SUBSISTEMAS
                      01321             ; 0 | TRAÇÃO | DIREÇÃO | SINALIZAÇÃO | SENSORES | COLISAO
                      01322             
                      01323         ; 81 - ASP - MOTORISTA ESCREVE PARA O CARRO OS NOVOS COMANDOS PARA OS SUBSISTEMAS
                      01324             ; 0 | TRAÇÃO | DIREÇÃO | SINALIZAÇÃO | 0XFF | 0XFF  
                      01325             
                      01326         ; 6  - ACK - CARRO CONFIRMA A INSTRUÇÃO RECEBIDA
                      01327             ; INSTRUÇÃO | 0XFF | 0XFF | 0XFF | 0XFF | 0XFF
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01328             
                      01329         ; 5  - ENQ - MOTORISTA PERGUNTA SE OS SUBSISTEMAS ESTÃO OPERACIONAIS
                      01330             ; DISPOSITIVO | 0XFF | 0XFF | 0XFF | 0XFF | 0XFF
                      01331             
                      01332         ; 21 - NAK - CARRO INFORMA ERRO NO CÓDIGO RECEBIDO
                      01333               ; COD_ERRO | CÓDIGO DA INSTRUÇÃO | 0XFF | 0XFF | 0XFF | 0XFF
                      01334           
                      01335         ; 51 - E1B - MOTORISTA COLOCA O CARRO PARA RECAL, TENDO COMO MUDAR PARAMETROS DOS SUBSISTEMAS
                      01336               ; ENDEREÇO DA EEPRON | DADO PARA COLOCAR NO ENDEREÇO | 0XFF | 0XFF | 0XFF | 0XFF 
                      01337               
                      01338         ; CODIGO DE ERRO
                      01339         ; 1 - CRC   - ERRO DE CRC-8
                      01340         ; 2 - IDC   - INSTRUÇÃO DESCONHECIDA OU INEXISTENTE
                      01341         ; 3 - DNO   - DISPOSITIVO NÃO OPERACIONAL
                      01342         ; 4 - DIN   - DISPOSITIVO INEXISTENTE
                      01343         ; 5 - MDC   - MESTRE NÃO RECONHECIDO
                      01344         ; 6 - OVF   - OVERFLOW - ERRO DE OPERAÇÃO DE CÁLCULO
                      01345 
023B                  01346 TRATA_L3
                      01347         ; TRAVA O CLOCK TALVEZ E NO FIM LIBERA [ DO I2C ]
                      01348         
                      01349         ;TRATA O CRC-8 PARA VER SE TA TUDO OK, CASO NÃO ESTEJA ENVIA UM NAK COM O ERRO DE CRC
                      01350         
023B   3053           01351         MOVLW   .83         ; SSP
023C   0673           01352         XORWF   COD, 0
023D   1903           01353         BTFSC   STATUS, Z
023E   2A4D           01354               GOTO    MOTORISTA_SOLICITA_SUBSISTEMAS
                      01355         
023F   3051           01356         MOVLW   .81         ; ASP
0240   0673           01357         XORWF   COD, 0
0241   1903           01358         BTFSC   STATUS, Z
0242   2A66           01359               GOTO    MOTORISTA_COMANDO_SUBSISTEMAS
                      01360            
0243   3005           01361         MOVLW   .5          ; ENQ
0244   0673           01362         XORWF   COD, 0
0245   1903           01363         BTFSC   STATUS, Z
0246   2A6D           01364               GOTO    ESTA_OPERACIONAL
                      01365               
0247   3033           01366         MOVLW   .51         ; E1B
0248   0673           01367         XORWF   COD, 0
0249   1903           01368         BTFSC   STATUS, Z
024A   2AB0           01369               GOTO    RECALL
                      01370         
024B   3002           01371         MOVLW   .2          ; INSTRUÇÃO DESCONHECIDA
024C   2AA1           01372         GOTO    ENVIA_NAK   ; ENVIA O NAK
                      01373         
024D                  01374 MOTORISTA_SOLICITA_SUBSISTEMAS
                      01375         ; O ENDEREÇO DO CARRO VAI SER O ENDEREÇO NÚMERO 15
                      01376         ; RESPONTE COM O 80 RSP
                      01377         ; 0 | TRAÇÃO | DIREÇÃO | SINALIZAÇÃO | SENSORES | COLISAO
                      01378         
                      01379         ; NÃO PRECISA ENVIAR ACK AQUI
                      01380 ;       MOVLW   .83
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01381 ;       CALL    ACK
                      01382         
024D   3001           01383         MOVLW   0X01
024E   00F0           01384         MOVWF   SOH
                      01385         
024F   300F           01386         MOVLW   0X0F    ; ENDEREÇO DO SLAVE VAI SER 15
0250   00F1           01387         MOVWF   IDS
                      01388         
0251   300A           01389         MOVLW   .10
0252   00F2           01390         MOVWF   IDD     ; ENDEREÇO DO MASTER VAI SER 10
                      01391         
0253   3050           01392         MOVLW   .80
0254   00F3           01393         MOVWF   COD
                      01394         
0255   3000           01395         MOVLW   .0
0256   00F4           01396         MOVWF   DATA_P1
                      01397         
0257   0855           01398         MOVF    TRACAO, W
0258   00F5           01399         MOVWF   DATA_P2
                      01400 
0259   0856           01401         MOVF    DIRECAO, W
025A   00F6           01402         MOVWF   DATA_P3
                      01403         
025B   0857           01404         MOVF    SINALIZACAO, W
025C   00F7           01405         MOVWF   DATA_P4
                      01406         
025D   0858           01407         MOVF    SENSORES, W
025E   00F8           01408         MOVWF   DATA_P5
                      01409         
025F   0859           01410         MOVF    COLISAO, W
0260   00F9           01411         MOVWF   DATA_P6
                      01412 
0261   30FF           01413         MOVLW   .255
0262   00FA           01414         MOVWF   PAD
                      01415         
                      01416         ;TRATA O CRC-8 COM OS DADOS PRESENTES E CALCULA O VALOR DO CRC
0263   30FF           01417         MOVLW   .255
0264   00FB           01418         MOVWF   CRC8
                      01419         
0265   0008           01420         RETURN
                      01421         
0266                  01422 MOTORISTA_COMANDO_SUBSISTEMAS
                      01423         ; 81 - ASP - MOTORISTA ESCREVE PARA O CARRO OS NOVOS COMANDOS PARA OS SUBSISTEMAS
                      01424         ; 0 | TRAÇÃO | DIREÇÃO | SINALIZAÇÃO | 0XFF | 0XFF      
                      01425         
0266   0875           01426         MOVF    DATA_P2, W
0267   00D5           01427         MOVWF   TRACAO
                      01428         
0268   0876           01429         MOVF    DATA_P3, W
0269   00D6           01430         MOVWF   DIRECAO
                      01431         
Message[305]: Using default destination of 1 (file).
026A   08F7           01432         MOVF    DATA_P4
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

026B   00D7           01433         MOVWF   SINALIZACAO
                      01434         
                      01435         ; OS OUTROS SÃO SENSORES, NÃO PODE MUDAR O ESTADO DELES
                      01436         
026C   0008           01437         RETURN
                      01438         
026D                  01439 ESTA_OPERACIONAL
                      01440         ; 5  - ENQ - MOTORISTA PERGUNTA SE OS SUBSISTEMAS ESTÃO OPERACIONAIS
                      01441         ; DISPOSITIVO | 0XFF | 0XFF | 0XFF | 0XFF | 0XFF
026D   01F4           01442         CLRF    DATA_P1
026E   30FF           01443         MOVLW   .255
026F   00F5           01444         MOVWF   DATA_P2
0270   00F6           01445         MOVWF   DATA_P3
0271   00F7           01446         MOVWF   DATA_P4
0272   00F8           01447         MOVWF   DATA_P5
0273   00F9           01448         MOVWF   DATA_P6
                      01449         
0274   3002           01450         MOVLW   .2                      ; VERIFICA O ENDEREÇO DOS SUBSISTEMAS
0275   0674           01451         XORWF   DATA_P1, 0
0276   1903           01452         BTFSC   STATUS, Z
0277   2A88           01453             GOTO    COLISAO_OPERACIONAL
                      01454         
0278   3003           01455         MOVLW   .3
0279   0674           01456         XORWF   DATA_P1, 0
027A   1903           01457         BTFSC   STATUS, Z
027B   2A8D           01458             GOTO    SENSORES_OPERACIONAL
                      01459         
027C   3004           01460         MOVLW   .4
027D   0674           01461         XORWF   DATA_P1, 0
027E   1903           01462         BTFSC   STATUS, Z
027F   2A92           01463             GOTO    DIRECAO_OPERACIONAL
                      01464             
0280   3005           01465         MOVLW   .5
0281   0674           01466         XORWF   DATA_P1, 0
0282   1903           01467         BTFSC   STATUS, Z
0283   2A97           01468             GOTO    TRACAO_OPERACIONAL
                      01469             
0284   3006           01470         MOVLW   .6
0285   0674           01471         XORWF   DATA_P1, 0
0286   1903           01472         BTFSC   STATUS, Z
0287   2A9C           01473             GOTO    SINALIZACAO_OPERACIONAL    
                      01474             
                      01475             
0288                  01476 COLISAO_OPERACIONAL
0288   1D43           01477             BTFSS   OP_COLISAO  ; OPERACIONAL, 1
0289   0008           01478                 RETURN
028A   3002           01479             MOVLW   .2
028B   00F4           01480             MOVWF   DATA_P1
028C   0008           01481             RETURN
028D                  01482 SENSORES_OPERACIONAL
028D   1DC3           01483             BTFSS   OP_SENSORES ; OPERACIONAL, 2
028E   0008           01484                 RETURN
028F   3003           01485             MOVLW   .3
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0290   00F4           01486             MOVWF   DATA_P1    
0291   0008           01487             RETURN
0292                  01488 DIRECAO_OPERACIONAL
0292   1E43           01489             BTFSS   OP_DIRECAO  ; OPERACIONAL, 3
0293   0008           01490                 RETURN
0294   3004           01491             MOVLW   .4
0295   00F4           01492             MOVWF   DATA_P1
0296   0008           01493             RETURN
0297                  01494 TRACAO_OPERACIONAL
0297   1EC3           01495             BTFSS   OP_TRACAO   ; OPERACIONAL, 4
0298   0008           01496                 RETURN
0299   3005           01497             MOVLW   .5
029A   00F4           01498             MOVWF   DATA_P1
029B   0008           01499             RETURN
029C                  01500 SINALIZACAO_OPERACIONAL
029C   1F43           01501             BTFSS   OP_SINALIZACAO      ; OPERACIONAL, 5
029D   0008           01502                 RETURN
029E   3005           01503             MOVLW   .5
029F   00F4           01504             MOVWF   DATA_P1
02A0   0008           01505             RETURN
                      01506         
                      01507 ; 21 - NAK - CARRO INFORMA ERRO NO CÓDIGO RECEBIDO
                      01508               ; COD_ERRO | CÓDIGO DA INSTRUÇÃO | 0XFF | 0XFF | 0XFF | 0XFF
02A1                  01509 ENVIA_NAK
                      01510             
02A1   00F4           01511             MOVWF   DATA_P1     ; RECEBE DO WORK O CODIGO DE ERRO QUE SERÁ ENVIADO.
                      01512                     
02A2   0873           01513             MOVF    COD, W
02A3   00F5           01514             MOVWF   DATA_P2
                      01515             
02A4   300F           01516             MOVLW   .15     ; MEU ENDEREÇO
02A5   00F1           01517             MOVWF   IDS
                      01518             
02A6   300A           01519             MOVLW   .10
02A7   00F2           01520             MOVWF   IDD     ; ENDEREÇO DE DESTINO
                      01521             
02A8   3015           01522             MOVLW   .21
02A9   00F3           01523             MOVWF   COD
                      01524             
02AA   30FF           01525             MOVLW   .255
02AB   00F6           01526             MOVWF   DATA_P3
02AC   00F7           01527             MOVWF   DATA_P4
02AD   00F8           01528             MOVWF   DATA_P5
02AE   00F9           01529             MOVWF   DATA_P6
                      01530             
02AF   0008           01531             RETURN
                      01532             
                      01533             
02B0                  01534 RECALL  
                      01535             ; TODO
                      01536             ; VAI PREPARAR OS 4 BYTES DE DADOS PARA ENVIAR NO BARRAENTO DCH [ OWP ]
                      01537             ; BYTE_0 COM O VALOR 4
                      01538             ; ENDEREÇO DO SUBSISTEMA QUE SERÁ ALTERADO
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01539             ; ENDEREÇO DE MEMORIA DA EEPROM QUE SERÁ ALTERADO
                      01540             ; VALOR QUE SERÁ COLOCADO NA EEPROM DO SUBSISTEMA
                      01541             ; SETO UMA FLAG QUE SERÁ A FLAG SINALIZANDO O RECALL
                      01542             ; GOTO ENVIA
                      01543             
                      01544             ; 0 | TRAÇÃO | DIREÇÃO | SINALIZAÇÃO | SENSORES | COLISAO
                      01545         
                      01546     
                      01547     END
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 33


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BANK0                             BCF STATUS,RP0
BANK1                             BSF STATUS,RP0
BARRAMENTO                        00000037
BARRAMENTO_I2C                    0000002D
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BITS                              0000002A
BIT_0                             000000B8
BIT_1                             000000C5
BRGH                              00000002
BYTE                              00000029
BYTE_0                            00000050
BYTE_0_1                          00000060
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 34


SYMBOL TABLE
  LABEL                             VALUE 

CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
COD                               00000073
COLISAO                           00000059
COLISAO_ENVIAR_BITS               00000200
COLISAO_L3                        00000069
COLISAO_OPERACIONAL               00000288
COLISAO_START_BIT                 000001FB
CONCLUIDA_LEITURA                 000000D2
CONTADOR_BITS                     00000040
CONTADOR_BYTES                    0000003F
CONTADOR_START_BIT                0000003E
CONTADOR_START_SYNC               0000003C
CONT_1                            00000036
CONT_2                            00000035
CONT_BYTES_I2C                    00000039
CONT_START_SYNC_MASTER            0000002B
COUNT_SYNC                        00000022
CRC8                              0000007B
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DADO                              00000052
DADO_1                            00000062
DADO_I2C                          00000038
DADO_NULL                         00000064
DADO_SENSORES                     0000002F
DADO_SINALIZACAO                  0000002E
DATA_ADDRESS                      00000005
DATA_P1                           00000074
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 35


SYMBOL TABLE
  LABEL                             VALUE 

DATA_P2                           00000075
DATA_P3                           00000076
DATA_P4                           00000077
DATA_P5                           00000078
DATA_P6                           00000079
DC                                00000001
DELAY100MS                        0000021F
DELAY100MS_0                      00000223
DELAY10MS                         0000022A
DELAY10MS_0                       0000022E
DELAY_                            00000028
DELAY_MICRO                       00000235
DELAY_SYNC                        0000002C
DELAY_US                          00000214
DIRECAO                           00000056
DIRECAO_L3                        00000066
DIRECAO_OPERACIONAL               00000292
D_A                               00000005
D_NOT_A                           00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
ENDERECO                          00000051
ENDERECO_1                        00000061
ENDERECO_ENVIAR                   00000042
ENDERECO_SENSORES                 00000033
ENDERECO_SINALIZACAO              00000032
ENVIA                             00000175
ENVIAR_OK                         0000019F
ENVIA_0                           000001D6
ENVIA_1                           000001E2
ENVIA_BYTE                        000001D3
ENVIA_DADOS                       00000192
ENVIA_DIRECAO                     00000140
ENVIA_DIRECAO_2                   00000158
ENVIA_NAK                         000002A1
ENVIA_SENSORES                    00000150
ENVIA_SINALIZACAO                 00000168
ENVIA_TRACAO                      00000148
ENVIA_TRACAO_2                    00000160
ESCREVE_I2C                       00000037
ESCREVE_I2C_02                    00000048
ESPERA_BIT_0_MUDAR                000000C2
ESPERA_BIT_1_MUDAR                000000CF
ESPERA_SUBIDA_ST                  000000A5
ESPERA_SUBIDA_START_BIT           000000A2
ESTADO_SINALIZACAO                00000031
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 36


SYMBOL TABLE
  LABEL                             VALUE 

ESTAGIO                           00000041
ESTA_OPERACIONAL                  0000026D
F                                 00000001
FAROL                             ESTADO_SINALIZACAO, 0
FERR                              00000002
FIM_BYTE_0                        000001AD
FIM_DADO                          000001BF
FIM_ENDERECO                      000001B6
FIM_ENVIA_DADOS                   0000017C
FIM_START_BIT                     000001A8
FLAG_BYTE_0                       ESTAGIO, 1
FLAG_COLISAO                      BARRAMENTO, 1
FLAG_COL_ENVIAR_BIT               BARRAMENTO, 4
FLAG_COL_START_BIT                BARRAMENTO, 3
FLAG_DADO                         ESTAGIO, 3
FLAG_ENDERECO                     ESTAGIO, 2
FREIO                             ESTADO_SINALIZACAO, 2
FSR                               00000004
FSR_TEMP                          00000025
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_ERRO                          BARRAMENTO_I2C, 0
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
IDD                               00000072
IDENTIF_ESTADO2                   00000023
IDENTIF_ESTADO3                   0000002F
IDENTIF_ESTADO4                   00000040
IDENTIF_ESTADO5                   00000050
IDS                               00000071
INCREMENTA_LIMPA                  00000078
INCREMENTA_START_BIT              00000093
INDF                              00000000
INICIO                            0000010D
INICIO_START_SYNC                 0000006F
INIC_CONT_START_SYNC              0000006B
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
LER_BITS                          000000AA
LER_BITS_CONTINUA                 000000AF
LE_EEPROM                         00000106
LIMPA_MONITORIA                   00000170
MAIN                              00000138
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 37


SYMBOL TABLE
  LABEL                             VALUE 

MONITORA_BITS                     00000030
MONITORA_SUBSISTEMAS              00000027
MOTORISTA_COMANDO_SUBSISTEMAS     00000266
MOTORISTA_SOLICITA_SUBSISTEMAS    0000024D
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPERACIONAL                       00000043
OPTION_REG                        00000081
OP_COLISAO                        OPERACIONAL, 2
OP_DIRECAO                        OPERACIONAL, 4
OP_SENSORES                       OPERACIONAL, 3
OP_SINALIZACAO                    OPERACIONAL, 6
OP_TRACAO                         OPERACIONAL, 5
P                                 00000004
PAD                               0000007A
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCLATH_TEMP                       00000024
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PROPRIETARIO                      0000003D
PS0                               00000000
PS1                               00000001
PS2                               00000002
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 38


SYMBOL TABLE
  LABEL                             VALUE 

PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
PWM_FREIO                         .2
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE                                ESTADO_SINALIZACAO, 1
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RECALL                            000002B0
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 39


SYMBOL TABLE
  LABEL                             VALUE 

REQUISICAO                        DADO_SINALIZACAO, 5
RESGATA_REGS                      00000059
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SAI_INT                           000000F6
SALVA_COLISAO                     000000E7
SALVA_DIRECAO                     000000ED
SALVA_REGS                        00000004
SALVA_SENSORES                    000000EA
SALVA_SINALIZACAO                 000000F3
SALVA_TRACAO                      000000F0
SEN                               00000000
SENSORES                          00000058
SENSORES_L3                       00000068
SENSORES_OPERACIONAL              0000028D
SENSOR_1                          PORTB, RB4
SENSOR_2                          PORTB, RB5
SENSOR_3                          PORTB, RB6
SENSOR_4                          PORTB, RB7
SETA_DIREITA                      ESTADO_SINALIZACAO, 4
SETA_ESQUERDA                     ESTADO_SINALIZACAO, 3
SINALIZACAO                       00000057
SINALIZACAO_L3                    00000067
SINALIZACAO_OPERACIONAL           0000029C
SMP                               00000007
SOH                               00000070
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
START_BIT                         0000008E
START_BIT_CONFIGURA               0000008B
START_BIT_ENVIA                   000001C7
START_BIT_INICIO                  00000089
START_BIT_LOW                     0000009D
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 40


SYMBOL TABLE
  LABEL                             VALUE 

START_BIT_LOW_INICIO              0000009A
START_SYNC                        00000073
START_SYNC_MASTER                 00000209
START_SYNC_MASTER_0               0000020E
STATUS                            00000003
STATUS_TEMP                       00000021
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMP                              00000023
TEMPO0                            00000044
TEMPO_EM_BAIXA                    000001F7
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRACAO                            00000055
TRACAO_L3                         00000065
TRACAO_OPERACIONAL                00000297
TRATAR_COLISAO                    00000068
TRATA_BARRAMENTO                  00000062
TRATA_ESTADO1                     0000001D
TRATA_ESTADO2                     00000027
TRATA_ESTADO3                     00000033
TRATA_ESTADO4                     00000044
TRATA_ESTADO5                     00000055
TRATA_EVENTO                      00000014
TRATA_L3                          0000023B
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 41


SYMBOL TABLE
  LABEL                             VALUE 

TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
VALORES_SENSORES                  00000034
VERIFICA_1_0                      000000B5
VERIFICA_BARRAMENTO               00000184
VERIFICA_BARRAMENTO_0             0000018B
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 42


SYMBOL TABLE
  LABEL                             VALUE 

VERIFICA_MASTER                   00000085
VERIFICA_SLAVER                   0000007D
VERIFICA_START_BIT                00000097
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_AUX                             00000026
W_TEMP                            00000020
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
d1                                0000003A
d2                                0000003B
MPASM 5.77                    MASTER_I2C.ASM   10-14-2018  3:13:34         PAGE 43


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX ----------------
2000 : -------X-------- ---------------- ---------------- ----------------
2100 : XXXX------------ ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   685
Program Memory Words Free:  7507


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    52 reported,     0 suppressed

